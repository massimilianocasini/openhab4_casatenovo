[
    {
        "id": "f792b57.326bb48",
        "type": "tab",
        "label": "Cronotermostato",
        "disabled": true,
        "info": ""
    },
    {
        "id": "2c3370e7.9d5ff",
        "type": "tab",
        "label": "HomeBot",
        "disabled": false,
        "info": ""
    },
    {
        "id": "12045cd3287d8a9f",
        "type": "tab",
        "label": "Variabili globali",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "797c1ab8f59de950",
        "type": "tab",
        "label": "Cronotermostato Termosifoni",
        "disabled": false,
        "info": ""
    },
    {
        "id": "668d0f6536d63ae6",
        "type": "tab",
        "label": "Winter Condizionamento",
        "disabled": false,
        "info": ""
    },
    {
        "id": "0d5c9d22077c08ed",
        "type": "tab",
        "label": "Flow 1",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "6bc3878acc4dffa6",
        "type": "tab",
        "label": "Flow 2",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "7c89a60c.c53b78",
        "type": "tab",
        "label": "Flow 1",
        "disabled": false,
        "info": ""
    },
    {
        "id": "8850e193.e1712",
        "type": "subflow",
        "name": "SaveChart",
        "info": "",
        "category": "",
        "in": [
            {
                "x": 80,
                "y": 140,
                "wires": [
                    {
                        "id": "40784bb1.204934"
                    }
                ]
            }
        ],
        "out": [
            {
                "x": 820,
                "y": 120,
                "wires": [
                    {
                        "id": "a6525d2.cb354a",
                        "port": 0
                    }
                ]
            }
        ]
    },
    {
        "id": "edd62308.5b6eb",
        "type": "ui_group",
        "name": "Termosifoni",
        "tab": "8eef0cc0.5b1bf",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "d4495bdb.2d4448",
        "type": "ui_tab",
        "name": "Cronotermostato",
        "icon": "spa",
        "order": "1",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "e8a0d357.fcbaf",
        "type": "ui_base",
        "theme": {
            "name": "theme-light",
            "lightTheme": {
                "default": "#0094CE",
                "baseColor": "#0094CE",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": true,
                "reset": false
            },
            "darkTheme": {
                "default": "#097479",
                "baseColor": "#097479",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif",
                "edited": false
            },
            "customTheme": {
                "name": "Untitled Theme 1",
                "default": "#4B7930",
                "baseColor": "#4B7930",
                "baseFont": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
            },
            "themeState": {
                "base-color": {
                    "default": "#0094CE",
                    "value": "#0094CE",
                    "edited": false
                },
                "page-titlebar-backgroundColor": {
                    "value": "#0094CE",
                    "edited": false
                },
                "page-backgroundColor": {
                    "value": "#fafafa",
                    "edited": false
                },
                "page-sidebar-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-textColor": {
                    "value": "#1bbfff",
                    "edited": false
                },
                "group-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "group-backgroundColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "widget-textColor": {
                    "value": "#111111",
                    "edited": false
                },
                "widget-backgroundColor": {
                    "value": "#0094ce",
                    "edited": false
                },
                "widget-borderColor": {
                    "value": "#ffffff",
                    "edited": false
                },
                "base-font": {
                    "value": "-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"
                }
            },
            "angularTheme": {
                "primary": "indigo",
                "accents": "blue",
                "warn": "red",
                "background": "grey",
                "palette": "light"
            }
        },
        "site": {
            "name": "Node-RED Dashboard",
            "hideToolbar": "false",
            "allowSwipe": "false",
            "lockMenu": "false",
            "allowTempTheme": "true",
            "dateFormat": "DD/MM/YYYY",
            "sizes": {
                "sx": 48,
                "sy": 48,
                "gx": 6,
                "gy": 6,
                "cx": 6,
                "cy": 6,
                "px": 0,
                "py": 0
            }
        }
    },
    {
        "id": "601993d289b1de60",
        "type": "ui_group",
        "name": "HVAC Winter",
        "tab": "540f5159a33cd0ff",
        "order": 1,
        "disp": false,
        "width": "6",
        "collapse": false,
        "className": ""
    },
    {
        "id": "9b8f575a.b741a8",
        "type": "ui_group",
        "name": "Stat",
        "tab": "8eef0cc0.5b1bf",
        "order": 2,
        "disp": false,
        "width": "6"
    },
    {
        "id": "f0089344.b8ed1",
        "type": "ui_group",
        "name": "Ora",
        "tab": "8eef0cc0.5b1bf",
        "order": 2,
        "disp": false,
        "width": "6"
    },
    {
        "id": "8eef0cc0.5b1bf",
        "type": "ui_tab",
        "name": "Termosifoni",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "37f2a2e2.88cc6e",
        "type": "ui_group",
        "name": "Stat",
        "tab": "c675fdae.9cea1",
        "order": 1,
        "disp": false,
        "width": "6"
    },
    {
        "id": "c675fdae.9cea1",
        "type": "ui_tab",
        "name": "Stat",
        "icon": "dashboard"
    },
    {
        "id": "5cc1c037.e1064",
        "type": "telegram bot",
        "botname": "cm3home_nodered_casatenovo",
        "usernames": "",
        "chatids": "152196991",
        "baseapiurl": "",
        "updatemode": "polling",
        "pollinterval": "300",
        "usesocks": false,
        "sockshost": "",
        "socksport": "",
        "socksusername": "",
        "sockspassword": "",
        "bothost": "",
        "botpath": "",
        "localbotport": "",
        "publicbotport": "",
        "privatekey": "",
        "certificate": "",
        "useselfsignedcertificate": false,
        "sslterminated": false,
        "verboselogging": true
    },
    {
        "id": "eb6d7470c0839f99",
        "type": "openhab2-controller2",
        "name": "cm3home",
        "protocol": "http",
        "host": "localhost",
        "port": "8080",
        "path": "",
        "username": "",
        "password": "",
        "ohversion": "v3",
        "token": ""
    },
    {
        "id": "3ba37fd4.6558f",
        "type": "ui_group",
        "name": "Example Flow",
        "tab": "72415252.b2cadc",
        "order": 1,
        "disp": true,
        "width": "8",
        "collapse": false
    },
    {
        "id": "72415252.b2cadc",
        "type": "ui_tab",
        "name": "Home",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "540f5159a33cd0ff",
        "type": "ui_tab",
        "name": "HVAC Winter",
        "icon": "dashboard",
        "disabled": false,
        "hidden": false
    },
    {
        "id": "29361ffb5398d62e",
        "type": "profile",
        "name": "Casa",
        "time1": "00:00",
        "temp1": "10",
        "time2": "23:59",
        "temp2": "10",
        "time3": "",
        "temp3": "",
        "time4": "",
        "temp4": "",
        "time5": "",
        "temp5": "",
        "time6": "",
        "temp6": "",
        "time7": "",
        "temp7": "",
        "time8": "",
        "temp8": "",
        "time9": "",
        "temp9": "",
        "time10": "",
        "temp10": ""
    },
    {
        "id": "a0f72417.ea2838",
        "type": "file",
        "z": "8850e193.e1712",
        "name": "backup",
        "filename": "",
        "appendNewline": false,
        "createDir": true,
        "overwriteFile": "true",
        "x": 700,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "70a2db09.6ff354",
        "type": "file in",
        "z": "8850e193.e1712",
        "name": "restore",
        "filename": "",
        "format": "utf8",
        "sendError": true,
        "x": 530,
        "y": 120,
        "wires": [
            [
                "a6525d2.cb354a"
            ]
        ]
    },
    {
        "id": "922d4285.5f7e1",
        "type": "json",
        "z": "8850e193.e1712",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": false,
        "x": 530,
        "y": 160,
        "wires": [
            [
                "a0f72417.ea2838"
            ]
        ]
    },
    {
        "id": "a6525d2.cb354a",
        "type": "json",
        "z": "8850e193.e1712",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": false,
        "x": 690,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "40784bb1.204934",
        "type": "function",
        "z": "8850e193.e1712",
        "name": "LoadSave",
        "func": "var strSafe=msg.topic;\nif(strSafe)\n{\n    msg.filename =\"/share/chart.save\";\n    var loaded=context.get(strSafe)||0;\n    \n    if(0===loaded||strSafe==\"restore\")\n    {\n        //node.warn(\"Loading chart\");\n        msg.payload=\"load\";\n        context.set(strSafe,1);\n    }\n    else\n    {\n        //node.warn(\"Writing chart\");\n        //node.warn(msg.payload);\n    }\n    return msg;\n \n}\nreturn null;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 230,
        "y": 140,
        "wires": [
            [
                "51fb3038.7afb6"
            ]
        ]
    },
    {
        "id": "51fb3038.7afb6",
        "type": "switch",
        "z": "8850e193.e1712",
        "name": "Load data",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "load",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 380,
        "y": 140,
        "wires": [
            [
                "70a2db09.6ff354"
            ],
            [
                "922d4285.5f7e1"
            ]
        ]
    },
    {
        "id": "adf3caed.d9bbc8",
        "type": "ui_template",
        "z": "f792b57.326bb48",
        "group": "edd62308.5b6eb",
        "name": "css etc",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n\n.filled { height: 48px !important;padding: 0 !important; margin: 0 !important;}\n.nr-dashboard-template { padding: 0; margin: 0; background-color:black}\n.rounded { border-radius: 12px 12px 12px 12px;}\n.bigfont { font-size: 18px;}\n.smallfont { font-size: 12px;}\n.thedays { cursor:pointer; vertical-align:bottom; height:48px; }\n.the2px  { background-color: #9E9E9E; height:2px; }\n.theblocks {width:100%; height:0%; background-color:#4CAF50; }\n.greybuttons { background-color:#cecac536 !important; width:48px; border: none;}\n.thetemps { cursor:pointer; font-size:70%; color:#9E9E9E !important; }\n.smallheadings { color:blue; font-size:100%; }\n\n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "x": 400,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "ad58b5aa.16d818",
        "type": "ui_template",
        "z": "f792b57.326bb48",
        "group": "edd62308.5b6eb",
        "name": "Settings page",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<script>\nvar thedays=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\nvar ID = \"AA\";\n\nvar last=29;\n\nfunction bar(mm,val)\n{\nif (val==14) { $(mm).height(\"12%\"); $(mm).css('background-color', '#1E88E5'); } //blue\nif (val==15) { $(mm).height(\"16%\"); $(mm).css('background-color', '#039BE5'); }\nif (val==16) { $(mm).height(\"20%\"); $(mm).css('background-color', '#00ACC1'); } \nif (val==17) { $(mm).height(\"24%\"); $(mm).css('background-color', '#039BE5'); } // cyan\nif (val==18) { $(mm).height(\"28%\"); $(mm).css('background-color', '#00ACC1'); }\nif (val==19) { $(mm).height(\"32%\"); $(mm).css('background-color', '#00897B'); } \nif (val==20) { $(mm).height(\"36%\"); $(mm).css('background-color', '#388E3C'); } // green\nif (val==21) { $(mm).height(\"40%\"); $(mm).css('background-color', '#689F38'); }\nif (val==22) { $(mm).height(\"44%\"); $(mm).css('background-color', '#C0CA33'); }\nif (val==23) { $(mm).height(\"48%\"); $(mm).css('background-color', '#FDD835'); } // yellow\nif (val==24) { $(mm).height(\"52%\"); $(mm).css('background-color', '#FBC02D'); }\nif (val==25) { $(mm).height(\"56%\"); $(mm).css('background-color', '#FFA000'); }\nif (val==26) { $(mm).height(\"60%\"); $(mm).css('background-color', '#E64A19'); } // red\n    \n}\n\nfunction stat(text)\n{\n$(\"#info\"+ID).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID).text(\"Ok\"); clearTimeout(tm);}, 5000); //Tempo permanenza selezione\n}\n\nfunction selec(val,sta)\n{\nvar w=\"#td\"+val+ID;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n    (function(scope){\n        scope.ID = ID;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec(last,0); last=msg.selector; selec(last,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID; bar(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID; $(v).text(msg.timing[((msg.days-1)*24)+x]+\"°\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\"+ID).text(thedays[msg.days-1]);\n             if ((last>4) &&(last<29))\n                 $(\"#current\"+ID).text(msg.timing[((msg.days-1)*24)+last-5] + \"°\");\n             else\n                 $(\"#current\"+ID).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" style=\"color:red\" >Giorno</span></center></td>\n     <!--   <td colspan=3><center><span class=\"smallheadings\">Clima AUTO</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td> -->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID }}\" style=\"cursor:pointer;color:red;font-size:120%\">LUNEDI</span></center></td>\n     <!--   <td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:blue;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:blue;font-size:120%\">20</span></center></td> -->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td> \n     <!--   <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td> -->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\" style=\"color:red\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID }}\" class=\"smallheadings\" style=\"color:red\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\">\n                    <md-tooltip md-direction=\"bottom\">DECREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID }}\" style=\"color:red;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\">\n                    <md-tooltip md-direction=\"bottom\">INCREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 480,
        "y": 140,
        "wires": [
            [
                "407e6882.69b108"
            ]
        ]
    },
    {
        "id": "407e6882.69b108",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "Process controls",
        "func": "if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=29;\nif ( typeof context.saving == 'undefined' ) context.saving=1;\nlet timing = global.get(\"timing\");\nif ( !timing || !Array.isArray(timing) ) \n    {\n        timing=[\n                14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                6,14\n                ];\n        context.saving=1;                    \n        global.set(\"timing\",timing);\n    }\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>1)&&(context.selector<29))\n                {\n                   timing[((context.days-1)*24)+(context.selector-5)]++; \n                    if (timing[((context.days-1)*24)+context.selector-5]>26){ timing[((context.days-1)*24)+context.selector-5]=26; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura aumentata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Temperatura clima aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[169+(context.selector-1)]<26) {  timing[169+(context.selector-1)]++; msg.foryou=\"Temperatura fuori casa aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) { msg.foryou=\"Giorno successivo\"; context.days++; if (context.days>7) { context.days = 1; } }\n                break;\n    case \"d\" :  if ((context.selector>1)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]--; \n                    if (timing[((context.days-1)*24)+context.selector-5]<14){ timing[((context.days-1)*24)+context.selector-5]=14; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura decrementata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Temperatura clima diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[169+(context.selector-1)]>12) { timing[169+(context.selector-1)]--; msg.foryou=\"Temperatura fuori casa diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) {  msg.foryou=\"Giorno precedente\";  context.days--; if (context.days < 1) { context.days = 7;  } }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         timing[((context.days-1)*24)+context.selector-4]=timing[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Temperatura copiata nello slot successivo\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing[((context.days)*24)+a]=timing[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Temperatura clima selezionata\"; \n               else if (msg.payload=='2') msg.foryou=\"Temperatura fuori casa selezionata\";\n               else if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione temperatura ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 703,
        "y": 192,
        "wires": [
            [
                "35b4fc46.528e74"
            ],
            [
                "f49af1a4.1457"
            ],
            [
                "e97ad286.f56e2"
            ]
        ]
    },
    {
        "id": "3d1003a1.30400c",
        "type": "inject",
        "z": "f792b57.326bb48",
        "name": "Once only",
        "props": [
            {
                "p": "payload",
                "v": "",
                "vt": "str"
            },
            {
                "p": "topic",
                "v": "",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 464.44449615478516,
        "y": 226.66668128967285,
        "wires": [
            [
                "407e6882.69b108",
                "700c1189.dd4cd"
            ]
        ]
    },
    {
        "id": "40301637.dd38a8",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "Process heat",
        "func": "var timing = global.get(\"timing\");\nvar now = new Date(msg.time);\nmsg.topic=\"SetPoint\"\n//msg.payload=timing[(now.getDay()*24)+now.getHours()-1];\nmsg.payload=timing[(now.getDay()*24)+now.getHours()-1];\nmsg.frost=timing[168];\nmsg.away=timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.payload + \"°C \" + msg.time});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 540,
        "wires": [
            [
                "8d0421ee.dfc2d",
                "23b96119664659b4"
            ]
        ]
    },
    {
        "id": "f49af1a4.1457",
        "type": "file",
        "z": "f792b57.326bb48",
        "name": "backup",
        "filename": "/etc/openhab/nodered/data/scheduler.log",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 892,
        "y": 191,
        "wires": [
            []
        ]
    },
    {
        "id": "700c1189.dd4cd",
        "type": "file in",
        "z": "f792b57.326bb48",
        "name": "Restore",
        "filename": "/etc/openhab/nodered/data/scheduler.log",
        "format": "utf8",
        "sendError": true,
        "encoding": "none",
        "allProps": false,
        "x": 681,
        "y": 270,
        "wires": [
            [
                "a705aa47.7f0ac8"
            ]
        ]
    },
    {
        "id": "a705aa47.7f0ac8",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "Restore data from SD",
        "func": "context.global.timing=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 881,
        "y": 270,
        "wires": [
            [
                "29fcc7fc.eae1a8"
            ]
        ]
    },
    {
        "id": "d1059b5.2603468",
        "type": "link in",
        "z": "f792b57.326bb48",
        "name": "restore",
        "links": [
            "e97ad286.f56e2"
        ],
        "x": 521.5,
        "y": 328,
        "wires": [
            [
                "700c1189.dd4cd"
            ]
        ]
    },
    {
        "id": "e97ad286.f56e2",
        "type": "link out",
        "z": "f792b57.326bb48",
        "name": "restore",
        "links": [
            "d1059b5.2603468"
        ],
        "x": 854.5,
        "y": 228,
        "wires": []
    },
    {
        "id": "3e8c11b6.8f44fe",
        "type": "link in",
        "z": "f792b57.326bb48",
        "name": "restoreSD",
        "links": [
            "29fcc7fc.eae1a8"
        ],
        "x": 541,
        "y": 192,
        "wires": [
            [
                "407e6882.69b108"
            ]
        ]
    },
    {
        "id": "29fcc7fc.eae1a8",
        "type": "link out",
        "z": "f792b57.326bb48",
        "name": "restoreSD",
        "links": [
            "3e8c11b6.8f44fe"
        ],
        "x": 1035,
        "y": 270,
        "wires": []
    },
    {
        "id": "35b4fc46.528e74",
        "type": "link out",
        "z": "f792b57.326bb48",
        "name": "setSettings",
        "links": [
            "4fd040a7.e11a2"
        ],
        "x": 855.5,
        "y": 152,
        "wires": []
    },
    {
        "id": "4fd040a7.e11a2",
        "type": "link in",
        "z": "f792b57.326bb48",
        "name": "setSettings",
        "links": [
            "35b4fc46.528e74"
        ],
        "x": 347.5,
        "y": 140,
        "wires": [
            [
                "ad58b5aa.16d818"
            ]
        ]
    },
    {
        "id": "b4d72d9d.b2818",
        "type": "comment",
        "z": "f792b57.326bb48",
        "name": "EDIT",
        "info": "https://flows.nodered.org/flow/65f411e9e37745a4bbeef5926d052c97\n\nSettings page:\n-thedays2\n-ID2\n-last2\n-bar2\n-stat2\n-selec2\n\nProcess controls\n-days2\n-selector2\n-saving2\n-timing2\n-temperatures2\n\nRestore data from SD\n-timing2\n\nProcess heat\n-timing2\n\nBackup/Restore File read\nchange name of the file .log",
        "x": 150,
        "y": 40,
        "wires": []
    },
    {
        "id": "2c47f290.a614de",
        "type": "ui_gauge",
        "z": "f792b57.326bb48",
        "name": "Gauge",
        "group": "edd62308.5b6eb",
        "order": 6,
        "width": "6",
        "height": "3",
        "gtype": "gage",
        "title": "Corridoio",
        "label": "°C",
        "format": "{{msg.payload | number:1}}",
        "min": 0,
        "max": "35",
        "colors": [
            "#162ee3",
            "#00e663",
            "#ca3838"
        ],
        "seg1": "18",
        "seg2": "25",
        "className": "",
        "x": 1210,
        "y": 440,
        "wires": []
    },
    {
        "id": "8f6920c1.c9c1f",
        "type": "ui_text",
        "z": "f792b57.326bb48",
        "group": "edd62308.5b6eb",
        "order": 4,
        "width": 2,
        "height": 1,
        "name": "Stato:",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "x": 850,
        "y": 580,
        "wires": []
    },
    {
        "id": "b762d144.b156d",
        "type": "ui_chart",
        "z": "f792b57.326bb48",
        "name": "Chart",
        "group": "edd62308.5b6eb",
        "order": 7,
        "width": 6,
        "height": "3",
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "3",
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": "",
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "x": 1210,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "f56cd59a.d90388",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "",
        "func": "var riscaldamentoModo=flow.get('riscaldamentoModo');\nvar riscaldamento;\nvar statorele=flow.get('statorele');\nvar setPointManuale=flow.get('setPointManuale');\n\n\nif ((msg.payload===true)&&(riscaldamentoModo!=2)&&(statorele===0)) { \n    msg.payload=\"ON\";\n    flow.set(\"statorele\", 1);\n    }\nelse if ((msg.payload===false)&&(statorele==1)) {\n    msg.payload=\"OFF\";\n    flow.set(\"statorele\", 0);\n    }\nelse {\nreturn null;\n}\nif (riscaldamentoModo==1) {\n    riscaldamento=\"Automatico\";\n     node.status({fill:\"green\",shape:\"dot\",text:\"In \"+riscaldamento});\n}\nelse if (riscaldamentoModo==3) {\n    riscaldamento=\"Manuale\";\n    node.status({fill:\"red\",shape:\"dot\",text:\"In \"+riscaldamento});\n}\nelse if (riscaldamentoModo==2){\n    riscaldamento=\"Disattivo\";\n    node.status({fill:\"red\",shape:\"dot\",text:\"In \"+riscaldamento});\n}\n\n\n\n//node.status({fill:\"red\",shape:\"dot\",text:\"In \"+riscaldamento});\n//node.status({fill:\"blue\",shape:\"dot\",text:\"Stato \"+msg.payload});\nreturn msg;\n\n\n",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 360,
        "wires": [
            [
                "db3058d7d343ccd8"
            ]
        ]
    },
    {
        "id": "8d0421ee.dfc2d",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "",
        "func": "let currentString;\nlet riscaldamentoModo=flow.get(\"riscaldamentoModo\");\nlet setPointManuale=flow.get(\"setPointManuale\");\n//newmsg={};\n//newmsg2={};\n\nif ((msg.topic==\"SetPoint\")&&(riscaldamentoModo==1)) {  //setpoint in modalità automatica\n    msg.payload=msg.payload;\n  //  newmsg2.payload=msg.payload;\n  //  newmsg2.topic=\"ItemUpdate\";\n    msg.topic=\"setTarget\";\n   // newMsg.payload=msg.payload;\n    node.status({fill:\"green\",shape:\"dot\",text:msg.topic + \" \" + msg.payload + \" Mod: AUTO =\" + riscaldamentoModo});\n    //return [msg, newmsg2];\n    return msg;\n} \n    \nif ((msg.topic==\"SetPoint\")&&(riscaldamentoModo==3)) { //setpoint in modalità manuale\n    //newmsg.payload=setPointManuale;\n    //newmsg.topic=\"setTarget\";\n    msg.payload = setPointManuale;\n    msg.topic=\"setTarget\";\n    //newMsg.payload=msg.payload;\n    node.status({fill:\"red\",shape:\"dot\",text:msg.topic + \" \" + msg.payload + \" Mod: MANU\"});\n    //return newmsg;\n    return msg;\n    \n}\n\nif ((msg.topic==\"SetPoint\")&&(riscaldamentoModo==2)) { //setpoint in modalità disattivo\n    //newmsg.payload=10;\n    msg.payload=10;\n    //newmsg.topic=\"setTarget\";\n    msg.topic=\"setTarget\";\n    //newMsg.payload=msg.payload;\n    node.status({fill:\"red\",shape:\"dot\",text:msg.topic + \" \" + msg.payload + \" Mod: DISAT\"});\n    //return newmsg;\n    return msg;\n}\n\nif (msg.payload.category==\"temperature\") { //registrazione temperatura attuale\n    //msg.payload=msg.payload\n    //msg.payload=msg.payload.state;\n    //newmsg.payload=msg.payload.state;\n    msg.payload=msg.payload.state;\n    //newmsg.topic=\"SetCurrent\";\n    msg.topic=\"setCurrent\";\n    node.status({fill:\"blue\",shape:\"dot\",text:msg.topic + \" \" + msg.payload});\n    //return newmsg ;\n    return msg;\n}\n//node.status({fill:\"blue\",shape:\"dot\",text:msg.topic + \" \" + msg.payload});\n//return [msg, newMsg] ;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 460,
        "wires": [
            [
                "55acbb4d.535004",
                "2f61610b2f1ec6d6"
            ]
        ]
    },
    {
        "id": "eb4e8467.e19678",
        "type": "ui_text",
        "z": "f792b57.326bb48",
        "group": "edd62308.5b6eb",
        "order": 5,
        "width": 2,
        "height": 1,
        "name": "Setpoint:",
        "label": "Setpoint",
        "format": "{{msg.payload}}°C",
        "layout": "row-right",
        "className": "",
        "x": 1220,
        "y": 560,
        "wires": []
    },
    {
        "id": "a072d3c1.c234b",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "",
        "func": "var riscaldamentoAuto=flow.get(\"riscaldamentoModo\");\n\n   if (msg.payload==1)\n   {\n    flow.set(\"riscaldamentoModo\", 1); \n    msg.payload.state=\"AUTO\";\n    }\n\n    else if (msg.payload==3)\n    {\n    flow.set(\"riscaldamentoModo\", 3); \n    msg.payload.state=\"MAN\";\n    }\n\n    else if (msg.payload==2)\n    {\n    flow.set(\"riscaldamentoModo\", 2); \n    msg.payload.state=\"DISATTIVO\";\n    }\nnode.status({fill:\"green\",shape:\"dot\",text:\"riscaldamentoModo \" + msg.payload});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "x": 780,
        "y": 720,
        "wires": [
            [
                "f1291e1e.46b2b"
            ]
        ]
    },
    {
        "id": "10da0faa.9fc34",
        "type": "inject",
        "z": "f792b57.326bb48",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 560,
        "y": 920,
        "wires": [
            [
                "c4c60161.14c28"
            ]
        ]
    },
    {
        "id": "c4c60161.14c28",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "General var",
        "func": "var riscaldamentoModo=flow.get('riscaldamentoModo');\nvar setPointManuale=flow.get('setPointManuale');\nflow.set(\"riscaldamentoModo\", 1);\nflow.set(\"setPointManuale\", 20);\nflow.set(\"statorele\", 0);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "1093a9.19de1c58",
        "type": "ui_text",
        "z": "f792b57.326bb48",
        "group": "edd62308.5b6eb",
        "order": 3,
        "width": 2,
        "height": 1,
        "name": "Modo:",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "x": 1130,
        "y": 720,
        "wires": []
    },
    {
        "id": "54a33921.96efc8",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "",
        "func": "var setPointManuale=flow.get(\"setPointManuale\");\n\nflow.set(\"setPointManuale\", msg.payload); \n\nnode.status({fill:\"green\",shape:\"dot\",text:\"setPointManuale \" + msg.payload});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 780,
        "wires": [
            []
        ]
    },
    {
        "id": "6ae39c31.68b9b4",
        "type": "inject",
        "z": "f792b57.326bb48",
        "name": "Every 5 sec",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "15",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 150,
        "y": 540,
        "wires": [
            [
                "413a4975.397978"
            ]
        ]
    },
    {
        "id": "f1291e1e.46b2b",
        "type": "change",
        "z": "f792b57.326bb48",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "3",
                "fromt": "num",
                "to": "MAN",
                "tot": "str"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "1",
                "fromt": "num",
                "to": "AUTO",
                "tot": "str"
            },
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "2",
                "fromt": "num",
                "to": "DISATTIVATO",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 720,
        "wires": [
            [
                "1093a9.19de1c58"
            ]
        ]
    },
    {
        "id": "39cd953c.06889a",
        "type": "function",
        "z": "f792b57.326bb48",
        "name": "",
        "func": "var statorele=flow.get('statorele');\n\nif (msg.payload ==='ON'){ \n    flow.set(\"statorele\", 1);\n    }\nelse if (msg.payload ==='OFF') {\n    flow.set(\"statorele\", 0);\n    }\nnode.status({fill:\"green\",shape:\"dot\",text:\"statorelè \" + msg.payload});\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 860,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "23b96119664659b4",
        "type": "debug",
        "z": "f792b57.326bb48",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 770,
        "y": 500,
        "wires": []
    },
    {
        "id": "5b05e8590c2cc4f0",
        "type": "comment",
        "z": "f792b57.326bb48",
        "name": "Relè caldaia",
        "info": "",
        "x": 1290,
        "y": 380,
        "wires": []
    },
    {
        "id": "0be7d1ee91bad665",
        "type": "comment",
        "z": "f792b57.326bb48",
        "name": "Relè caldaia",
        "info": "",
        "x": 370,
        "y": 660,
        "wires": []
    },
    {
        "id": "7b6793b995db1d20",
        "type": "comment",
        "z": "f792b57.326bb48",
        "name": "Modalità riscaldamento",
        "info": "",
        "x": 340,
        "y": 760,
        "wires": []
    },
    {
        "id": "db2c100b8737bab5",
        "type": "comment",
        "z": "f792b57.326bb48",
        "name": "Valore SetPoint manuale",
        "info": "",
        "x": 330,
        "y": 820,
        "wires": []
    },
    {
        "id": "4e44049633bfc817",
        "type": "comment",
        "z": "f792b57.326bb48",
        "name": "Sensore temperatura interna",
        "info": "",
        "x": 200,
        "y": 400,
        "wires": []
    },
    {
        "id": "2f61610b2f1ec6d6",
        "type": "debug",
        "z": "f792b57.326bb48",
        "name": "debug 1",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 830,
        "y": 440,
        "wires": []
    },
    {
        "id": "bd2a06f2e41ca126",
        "type": "debug",
        "z": "f792b57.326bb48",
        "name": "debug 2",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1110,
        "y": 300,
        "wires": []
    },
    {
        "id": "b7823297b7d49a7a",
        "type": "debug",
        "z": "f792b57.326bb48",
        "name": "debug 3",
        "active": false,
        "tosidebar": true,
        "console": true,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1170,
        "y": 600,
        "wires": []
    },
    {
        "id": "ee8de3ad966cd3c7",
        "type": "debug",
        "z": "f792b57.326bb48",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 280,
        "y": 460,
        "wires": []
    },
    {
        "id": "1298115ab8758726",
        "type": "openhab2-in2",
        "z": "f792b57.326bb48",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_Modo",
        "topic": "",
        "initialstate": false,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 520,
        "y": 740,
        "wires": [
            [
                "a072d3c1.c234b"
            ]
        ]
    },
    {
        "id": "8cc4152f66f3633b",
        "type": "openhab2-in2",
        "z": "f792b57.326bb48",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_Man_SP",
        "topic": "",
        "initialstate": false,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 530,
        "y": 820,
        "wires": [
            [
                "54a33921.96efc8"
            ]
        ]
    },
    {
        "id": "a682bead458ed936",
        "type": "openhab2-in2",
        "z": "f792b57.326bb48",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "FGS221_002_SwitchBinary2",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 540,
        "y": 680,
        "wires": [
            [
                "8f6920c1.c9c1f",
                "39cd953c.06889a"
            ]
        ]
    },
    {
        "id": "0297a7215344d290",
        "type": "openhab2-in2",
        "z": "f792b57.326bb48",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Lumi1T",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": false,
        "whenchanged": false,
        "changedfrom": "",
        "changedto": "",
        "x": 390,
        "y": 400,
        "wires": [
            [
                "55acbb4d.535004",
                "2f61610b2f1ec6d6"
            ]
        ]
    },
    {
        "id": "db3058d7d343ccd8",
        "type": "openhab2-out2",
        "z": "f792b57.326bb48",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "FGS221_002_SwitchBinary2",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1260,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "413a4975.397978",
        "type": "moment",
        "z": "f792b57.326bb48",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "Europe/Rome",
        "adjAmount": "1",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "Europe/Rome",
        "x": 310,
        "y": 540,
        "wires": [
            [
                "40301637.dd38a8",
                "23b96119664659b4",
                "ee8de3ad966cd3c7"
            ]
        ]
    },
    {
        "id": "55acbb4d.535004",
        "type": "ramp-thermostat",
        "z": "f792b57.326bb48",
        "name": "",
        "profile": "575d3a65.a451c4",
        "hysteresisplus": "0.2",
        "hysteresisminus": "0.1",
        "x": 770,
        "y": 380,
        "wires": [
            [
                "f56cd59a.d90388"
            ],
            [
                "2c47f290.a614de",
                "b762d144.b156d"
            ],
            [
                "eb4e8467.e19678",
                "bd2a06f2e41ca126",
                "b7823297b7d49a7a"
            ]
        ]
    },
    {
        "id": "83d33525.e17298",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 558,
        "y": 47,
        "wires": []
    },
    {
        "id": "fd825880.879e58",
        "type": "catch",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "scope": null,
        "x": 328,
        "y": 47,
        "wires": [
            [
                "83d33525.e17298"
            ]
        ]
    },
    {
        "id": "813a7e6e.59696",
        "type": "function",
        "z": "2c3370e7.9d5ff",
        "name": "initial inline keyboard message",
        "func": "context.global.keyboard = { pending : true, messageId : msg.payload.messageId };\n\nvar opts = {\n  //reply_to_message_id: msg.payload.messageId,\n  reply_markup: JSON.stringify({\n\n    \"inline_keyboard\": [[\n                            {\n                                \"text\": \"Stato caldaia\",\n                                \"callback_data\": \"1\"            \n                            }, \n                            {\n                                \"text\": \"Corridoio\",\n                                \"callback_data\": \"2\"            \n                            }, \n                            {\n                                \"text\": \"Studio\",\n                                \"callback_data\": \"3\"            \n                            }], \n                        \n                        [\n                            {\n                                \"text\": \"Stanza del sole\",\n                                \"callback_data\": \"4\"            \n                            }, \n                            {\n                                \"text\": \"Camera da letto\",\n                                \"callback_data\": \"5\"            \n                            }, \n                            {\n                                \"text\": \"Soggiorno\",\n                                \"callback_data\": \"6\"            \n                            }\n                        ]]\n            \n  })\n};\n\nmsg.payload.content = 'Benvenuto/a a casa, ecco un riepilogo';\nmsg.payload.options = opts;\n\nreturn [ msg ];\n",
        "outputs": "1",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 529.7592468261719,
        "y": 101.3032283782959,
        "wires": [
            [
                "6b9dfd6e.bdeba4",
                "d60e917befb34946"
            ]
        ]
    },
    {
        "id": "168d9c97.e9eb53",
        "type": "function",
        "z": "2c3370e7.9d5ff",
        "name": "save messageId",
        "func": "// We store the messageId to be able to edit this reply in the callback query. \ncontext.global.keyboard.messageId = msg.payload.sentMessageId;\nflow.set(\"messageId\",msg.payload.sentMessageId)\nreturn [ msg ];\n",
        "outputs": "1",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1060,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "92c12d8b.d7d1b",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 610,
        "y": 180,
        "wires": []
    },
    {
        "id": "bca26923.3956f8",
        "type": "function",
        "z": "2c3370e7.9d5ff",
        "name": "Update Keyboard",
        "func": "var msg_id=flow.get(\"messageId\");\n//var msg_id= 2;\nvar chatid=152196991;\n\n//context.global.keyboard = { pending : true, messageId : msg.payload.messageId };\nif (msg.payload.content == \"1\") //Caldaia\n{\nglobal.set(\"Page\",msg.payload.content)    \nvar reply_markup = {\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Menu\",\n                    \"callback_data\": \"0\"            \n                }], \n                [{\n                    \"text\": \"<<\",\n                    \"callback_data\": \"6\"            \n                },\n                {\n                    \"text\": \">>\",\n                    \"callback_data\": \"2\"            \n                }]\n            ]\n };\nvar options = {\n   chat_id: chatid,\n    reply_markup:reply_markup,\n    message_id:msg_id\n};\n\nmsg.payload.type=\"editMessageText\" \nmsg.payload.content = \"🔥 Stato Caldaia\"+\n\"\\n\"+\n\"\\n 🔥 \" + global.get(\"StatoCaldaia\") + \"    🌡 SP \"+ global.get(\"SetPointAuto\") +\" °C  \";\n\nmsg.payload.options = options;\nmsg.payload.chatId= chatid;\n\nreturn [ msg ];\n}\nelse if (msg.payload.content == \"2\") //Corridoio\n{\nglobal.set(\"Page\",msg.payload.content)    \nvar reply_markup = {\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Menu\",\n                    \"callback_data\": \"0\"            \n                }], \n                [{\n                    \"text\": \"<<\",\n                    \"callback_data\": \"1\"            \n                },\n                {\n                    \"text\": \">>\",\n                    \"callback_data\": \"3\"            \n                }]\n            ]\n };\nvar options = {\n   chat_id: chatid,\n    reply_markup:reply_markup,\n    message_id:msg_id\n};\n\nmsg.payload.type=\"editMessageText\" \nmsg.payload.content = \"🍡 Corridoio\"+\n\"\\n\"+\n\"\\n🌡 \" + global.get(\"T_Corridoio\") + \" 🌡  SP \" + global.get(\"SetPointAuto\") +\" °C \";\n\nmsg.payload.options = options;\nmsg.payload.chatId= chatid;\n\nreturn [ msg ];\n}\nelse if (msg.payload.content == \"3\") //Studio\n{\nglobal.set(\"Page\",msg.payload.content)    \nvar reply_markup = {\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Menu\",\n                    \"callback_data\": \"0\"            \n                }], \n                [{\n                    \"text\": \"<<\",\n                    \"callback_data\": \"2\"            \n                },\n                {\n                    \"text\": \">>\",\n                    \"callback_data\": \"4\"            \n                }]\n            ]\n };\nvar options = {\n   chat_id: chatid,\n    reply_markup:reply_markup,\n    message_id:msg_id\n};\n\nmsg.payload.type=\"editMessageText\" \nmsg.payload.content = \"👩‍🎓 Studio\"+\n\"\\n\"+\n\"\\n🌡 \" + global.get(\"T_Studio\") + \"   🔦 \"+ global.get(\"L_Studio\")  ;\n\nmsg.payload.options = options;\nmsg.payload.chatId= chatid;\n\nreturn [ msg ];\n}\nelse if (msg.payload.content == \"4\") //Camera R\n{\nglobal.set(\"Page\",msg.payload.content)    \nvar reply_markup = {\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Menu\",\n                    \"callback_data\": \"0\"            \n                }], \n                [{\n                    \"text\": \"<<\",\n                    \"callback_data\": \"3\"            \n                },\n                {\n                    \"text\": \">>\",\n                    \"callback_data\": \"5\"            \n                }]\n            ]\n };\nvar options = {\n   chat_id: chatid,\n    reply_markup:reply_markup,\n    message_id:msg_id\n};\n\nmsg.payload.type=\"editMessageText\" \nmsg.payload.content = \"🛏 Stanza del sole\"+\n\"\\n\"+\n\"\\n🌡 \" + global.get(\"T_Cameretta\") + \"   💧 \"+ global.get(\"H_Cameretta\") +\" %   💨  \"+ global.get(\"P_Cameretta\") +\" hPa\"+\n\"\\n\"+\n\"\\nFinestra : \"+ global.get(\"F_R\");\n\nmsg.payload.options = options;\nmsg.payload.chatId= chatid;\n\nreturn [ msg ];\n}\nelse if (msg.payload.content == \"5\") //Bagno\n{\nglobal.set(\"Page\",msg.payload.content)    \nvar reply_markup = {\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Menu\",\n                    \"callback_data\": \"0\"            \n                }], \n                [{\n                    \"text\": \"<<\",\n                    \"callback_data\": \"4\"            \n                },\n                {\n                    \"text\": \">>\",\n                    \"callback_data\": \"6\"            \n                }]\n            ]\n };\nvar options = {\n   chat_id: chatid,\n    reply_markup:reply_markup,\n    message_id:msg_id\n};\n\nmsg.payload.type=\"editMessageText\" \nmsg.payload.content = \"🛁 Bagno \"+\n\"\\n\"+\n\"\\n🌡 \" + global.get(\"T_Bagno\") + \" °C   💧 \"+ global.get(\"H_Bagno\") +\" %   💨  \"+ global.get(\"P_Bagno\") +\" hPa\"+\n\"\\n\";\n\n\nmsg.payload.options = options;\nmsg.payload.chatId= chatid;\n\nreturn [ msg ];\n}\nelse if (msg.payload.content == \"6\") //Esterno\n{\nglobal.set(\"Page\",msg.payload.content)    \nvar reply_markup = {\n    \"inline_keyboard\": [[\n                {\n                    \"text\": \"Menu\",\n                    \"callback_data\": \"0\"            \n                }], \n                [{\n                    \"text\": \"<<\",\n                    \"callback_data\": \"5\"            \n                },\n                {\n                    \"text\": \">>\",\n                    \"callback_data\": \"1\"            \n                }]\n            ]\n };\nvar options = {\n   chat_id: chatid,\n    reply_markup:reply_markup,\n    message_id:msg_id\n};\n\nmsg.payload.type=\"editMessageText\" \nmsg.payload.content = \"🌲 Esterno \"+\n\"\\n\"+\n\"\\n🌡 \" + global.get(\"T_Esterno\") + \" °C   💧 \"+ global.get(\"H_Esterno\") +\" %   💨  \"+ global.get(\"P_Esterno\") +\" hPa\"+\n\"\\n\";\n\nmsg.payload.options = options;\nmsg.payload.chatId= chatid;\n\nreturn [ msg ];\n}\nelse if (msg.payload.content ==\"0\")\n{\nglobal.set(\"Page\",\"0\")     \nvar reply_markup = {\n    \"inline_keyboard\": [\n                [{\n                    \"text\": \"Stato Caldaia\",\n                    \"callback_data\": \"1\"            \n                }, \n                {\n                    \"text\": \"Corridoio\",\n                    \"callback_data\": \"2\"            \n                }],\n                [{\n                    \"text\": \"Studio\",\n                    \"callback_data\": \"3\"            \n                }, \n                {\n                    \"text\": \"Stanza del sole\",\n                    \"callback_data\": \"4\"            \n                }],\n                [{\n                    \"text\": \"Bagno\",\n                    \"callback_data\": \"5\"            \n                }, \n                {\n                    \"text\": \"Esterno\",\n                    \"callback_data\": \"6\"            \n                }]\n                \n            ]\n };\nvar options = {\n   chat_id: chatid,\n    reply_markup:reply_markup,\n    message_id:msg_id\n};\nmsg.payload.type=\"editMessageText\" \nmsg.payload.content = \"🏠 Benvenuto/a a casa\"+\n\"\\n\"+\n\"\\nRiepilogo :\"+\n\"\\n\"+\n\"\\n🔥 Stato Caldaia         🌡  \" + global.get(\"StatoCaldaia\") + \"   🌡 SP \"+ global.get(\"SetPointAuto\") +\" °C\" +\n\"\\n\"+\n\"\\n🍡 Corridoio             🌡  \" + global.get(\"T_Corridoio\") + \"  🌡 SP \"+ global.get(\"SetPointAuto\") +\" °C\" +\n\"\\n\"+\n\"\\n👩‍🎓 Studio                🌡  \" + global.get(\"T_Studio\") + \"   🔦  \"+ global.get(\"L_Studio\") +\n\"\\n\"+\n\"\\n🛏 Stanza del sole       🌡  \" + global.get(\"T_Cameretta\") + \"   💧 \"+ global.get(\"H_Cameretta\") +\" %\"+\n\"\\n\"+\n\"\\n🛁 Bagno                 🌡  \" + global.get(\"T_Bagno\") + \" °C   💧 \"+ global.get(\"H_Bagno\") +\" %\"+\n\"\\n\"+\n\"\\n🌲 Esterno               🌡  \" + global.get(\"T_Esterno\") + \" °C   💧 \"+ global.get(\"H_Esterno\") +\" %\";\nmsg.payload.options = options;\nmsg.payload.chatId= chatid;\n\nreturn [ msg ];\n}",
        "outputs": "1",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 320,
        "wires": [
            [
                "1fda55cb.4110ba"
            ]
        ]
    },
    {
        "id": "d43d1d.d16b72e",
        "type": "inject",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "{\"content\":\"0\"}",
        "payloadType": "json",
        "x": 120,
        "y": 560,
        "wires": [
            [
                "a53c8846.40f9c8",
                "ef36fb49.4dead8",
                "b530dc19.1fca2",
                "6320ee66.b8449",
                "e22b6170.dda2c"
            ]
        ]
    },
    {
        "id": "a53c8846.40f9c8",
        "type": "random",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "low": "15",
        "high": "25",
        "inte": "true",
        "property": "payload",
        "x": 720,
        "y": 540,
        "wires": [
            [
                "d25c42e7.b6b5e"
            ]
        ]
    },
    {
        "id": "ef36fb49.4dead8",
        "type": "random",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "low": "15",
        "high": "25",
        "inte": "true",
        "property": "payload",
        "x": 717.8999977111816,
        "y": 576.9999885559082,
        "wires": [
            [
                "e77189ee.a8f738"
            ]
        ]
    },
    {
        "id": "d25c42e7.b6b5e",
        "type": "change",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "T_Sala",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 907.0000343322754,
        "y": 539.9999885559082,
        "wires": [
            []
        ]
    },
    {
        "id": "e77189ee.a8f738",
        "type": "change",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "T_NY",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 897.8999977111816,
        "y": 577.9999885559082,
        "wires": [
            []
        ]
    },
    {
        "id": "8a0e8af0.4b9228",
        "type": "change",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "T_Bagno",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 914.8999977111816,
        "y": 618.9999885559082,
        "wires": [
            []
        ]
    },
    {
        "id": "b530dc19.1fca2",
        "type": "random",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "low": "15",
        "high": "25",
        "inte": "true",
        "property": "payload",
        "x": 724.8999977111816,
        "y": 617.9999885559082,
        "wires": [
            [
                "8a0e8af0.4b9228"
            ]
        ]
    },
    {
        "id": "19932204.b6f83e",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "x": 553.1000366210938,
        "y": 409.3999938964844,
        "wires": []
    },
    {
        "id": "6320ee66.b8449",
        "type": "function",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "func": "msg.payload.content=global.get(\"Page\");\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 360,
        "wires": [
            [
                "bca26923.3956f8",
                "19932204.b6f83e"
            ]
        ]
    },
    {
        "id": "8092678f.ed0028",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 617,
        "y": 269,
        "wires": []
    },
    {
        "id": "e22b6170.dda2c",
        "type": "change",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "F_R",
                "pt": "global",
                "to": "chiusa",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 420,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "9fb5c2234ea0e56a",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 610,
        "y": 220,
        "wires": []
    },
    {
        "id": "9e5228f9c0398d15",
        "type": "inject",
        "z": "2c3370e7.9d5ff",
        "name": "Every 30 sec",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "30",
        "crontab": "",
        "once": true,
        "onceDelay": "1",
        "topic": "",
        "payloadType": "str",
        "x": 120,
        "y": 360,
        "wires": [
            [
                "6320ee66.b8449"
            ]
        ]
    },
    {
        "id": "d60e917befb34946",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1090,
        "y": 140,
        "wires": []
    },
    {
        "id": "fcfdbb6ba82847e7",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 330,
        "y": 280,
        "wires": []
    },
    {
        "id": "fab48187592d1944",
        "type": "debug",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "x": 1050,
        "y": 40,
        "wires": []
    },
    {
        "id": "300ec5fe.45799a",
        "type": "telegram receiver",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "bot": "5cc1c037.e1064",
        "saveDataDir": "",
        "filterCommands": false,
        "x": 140,
        "y": 220,
        "wires": [
            [
                "9fb5c2234ea0e56a"
            ],
            [
                "8092678f.ed0028"
            ]
        ]
    },
    {
        "id": "74ccbb46.ad0434",
        "type": "telegram command",
        "z": "2c3370e7.9d5ff",
        "name": "/start",
        "command": "/start",
        "description": "",
        "registercommand": false,
        "language": "",
        "bot": "5cc1c037.e1064",
        "strict": false,
        "hasresponse": false,
        "useregex": false,
        "removeregexcommand": false,
        "outputs": 1,
        "x": 130,
        "y": 140,
        "wires": [
            [
                "813a7e6e.59696",
                "92c12d8b.d7d1b"
            ]
        ]
    },
    {
        "id": "214f20b2.8bc57",
        "type": "telegram event",
        "z": "2c3370e7.9d5ff",
        "name": "",
        "bot": "5cc1c037.e1064",
        "event": "callback_query",
        "autoanswer": true,
        "x": 140,
        "y": 300,
        "wires": [
            [
                "bca26923.3956f8",
                "fcfdbb6ba82847e7"
            ]
        ]
    },
    {
        "id": "6b9dfd6e.bdeba4",
        "type": "telegram sender",
        "z": "2c3370e7.9d5ff",
        "name": "show inline keyboard",
        "bot": "5cc1c037.e1064",
        "outputs": 1,
        "x": 790.7594223022461,
        "y": 100.30331039428711,
        "wires": [
            [
                "168d9c97.e9eb53",
                "fab48187592d1944"
            ]
        ]
    },
    {
        "id": "1fda55cb.4110ba",
        "type": "telegram sender",
        "z": "2c3370e7.9d5ff",
        "name": "answer callback query",
        "bot": "5cc1c037.e1064",
        "outputs": 1,
        "x": 1020,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "383bc60af38b94d5",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "tempCurrent",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 930,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "a96b7091c9ed4570",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "statoCaldaia",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "cd6ef6a2bc9cf485",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "T_Studio",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "6a9a73b37e2a7509",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "L_Studio",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "87b47c3dc55ba3f0",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "setPointManuale",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 120,
        "wires": [
            []
        ]
    },
    {
        "id": "1ad7f7454a79a4a7",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "riscaldamentoModo",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "edf729257aa5e021",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "SonoOffT",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 540,
        "y": 180,
        "wires": [
            [
                "383bc60af38b94d5"
            ]
        ]
    },
    {
        "id": "fdc27e0b8e9b95cb",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "FGS221_002_SwitchBinary2",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 580,
        "y": 300,
        "wires": [
            [
                "a96b7091c9ed4570"
            ]
        ]
    },
    {
        "id": "01269089f52c036a",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "FGMS001_008_Temp",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 560,
        "y": 360,
        "wires": [
            [
                "cd6ef6a2bc9cf485"
            ]
        ]
    },
    {
        "id": "e2a8bdadad965849",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "FGMS001_008_Lum",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 550,
        "y": 420,
        "wires": [
            [
                "6a9a73b37e2a7509"
            ]
        ]
    },
    {
        "id": "b3cc43ae733cfd63",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_Man_SP",
        "topic": ".topic",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 570,
        "y": 120,
        "wires": [
            [
                "87b47c3dc55ba3f0"
            ]
        ]
    },
    {
        "id": "ca7cb4da8384c349",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_Modo",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 560,
        "y": 500,
        "wires": [
            [
                "1ad7f7454a79a4a7"
            ]
        ]
    },
    {
        "id": "27b24e8d3294e98d",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Prodino0_optoIn0",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 550,
        "y": 700,
        "wires": [
            [
                "ac4fd5d7bab04ec2"
            ]
        ]
    },
    {
        "id": "ac4fd5d7bab04ec2",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "statoAntifurto",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1010,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "2e3596d57c143087",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "HvACMode",
        "topic": ".topic",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 530,
        "y": 760,
        "wires": [
            [
                "9cd57367b47e545f"
            ]
        ]
    },
    {
        "id": "9cd57367b47e545f",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hvacMode",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 920,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "0f9165cfcf828d04",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "HvACWinterMode",
        "topic": ".topic",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 550,
        "y": 820,
        "wires": [
            [
                "2625e94e076bec33"
            ]
        ]
    },
    {
        "id": "2625e94e076bec33",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hvacWinterMode",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "83f9db32a215b8ea",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "HvACSetPointWinterManual",
        "topic": ".topic",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 580,
        "y": 1000,
        "wires": [
            [
                "0591a4d1107686a5"
            ]
        ]
    },
    {
        "id": "0591a4d1107686a5",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hvacSPWManual",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "8664e17906b9f085",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "gSwCondPower",
        "topic": ".topic",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 540,
        "y": 1060,
        "wires": [
            [
                "2f58e115a2885fe5"
            ]
        ]
    },
    {
        "id": "2f58e115a2885fe5",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "gSwCondPower",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 980,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "4815848dba7085ef",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_HvAC",
        "topic": "",
        "initialstate": true,
        "whenupdated": true,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 560,
        "y": 560,
        "wires": [
            [
                "75eb6d689f680f3f"
            ]
        ]
    },
    {
        "id": "75eb6d689f680f3f",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "riscaldamentoHvAC",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "3e8c26548d27cff6",
        "type": "bigtimer",
        "z": "12045cd3287d8a9f",
        "outtopic": "",
        "outpayload1": "1",
        "outpayload2": "0",
        "name": "Big Timer",
        "comment": "",
        "lat": 0,
        "lon": 0,
        "starttime": "300",
        "endtime": "420",
        "starttime2": 0,
        "endtime2": 0,
        "startoff": 0,
        "endoff": 0,
        "startoff2": 0,
        "endoff2": 0,
        "offs": 0,
        "outtext1": "1",
        "outtext2": "0",
        "timeout": 1440,
        "sun": true,
        "mon": true,
        "tue": true,
        "wed": true,
        "thu": true,
        "fri": true,
        "sat": true,
        "jan": true,
        "feb": true,
        "mar": true,
        "apr": true,
        "may": true,
        "jun": true,
        "jul": true,
        "aug": true,
        "sep": true,
        "oct": true,
        "nov": true,
        "dec": true,
        "day1": 0,
        "month1": 0,
        "day2": 0,
        "month2": 0,
        "day3": 0,
        "month3": 0,
        "day4": 0,
        "month4": 0,
        "day5": 0,
        "month5": 0,
        "day6": 0,
        "month6": 0,
        "day7": 0,
        "month7": 0,
        "day8": 0,
        "month8": 0,
        "day9": 0,
        "month9": 0,
        "day10": 0,
        "month10": 0,
        "day11": 0,
        "month11": 0,
        "day12": 0,
        "month12": 0,
        "d1": 0,
        "w1": 0,
        "d2": 0,
        "w2": 0,
        "d3": 0,
        "w3": 0,
        "d4": 0,
        "w4": 0,
        "d5": 0,
        "w5": 0,
        "d6": 0,
        "w6": 0,
        "xday1": 0,
        "xmonth1": 0,
        "xday2": 0,
        "xmonth2": 0,
        "xday3": 0,
        "xmonth3": 0,
        "xday4": 0,
        "xmonth4": 0,
        "xday5": 0,
        "xmonth5": 0,
        "xday6": 0,
        "xmonth6": 0,
        "xday7": 0,
        "xmonth7": 0,
        "xday8": 0,
        "xmonth8": 0,
        "xday9": 0,
        "xmonth9": 0,
        "xday10": 0,
        "xmonth10": 0,
        "xday11": 0,
        "xmonth11": 0,
        "xday12": 0,
        "xmonth12": 0,
        "xd1": 0,
        "xw1": 0,
        "xd2": 0,
        "xw2": 0,
        "xd3": 0,
        "xw3": 0,
        "xd4": 0,
        "xw4": 0,
        "xd5": 0,
        "xw5": 0,
        "xd6": 0,
        "xw6": 0,
        "suspend": false,
        "random": false,
        "randon1": false,
        "randoff1": false,
        "randon2": false,
        "randoff2": false,
        "repeat": true,
        "atstart": true,
        "odd": false,
        "even": false,
        "x": 520,
        "y": 620,
        "wires": [
            [],
            [
                "40bb95a040e7d57b"
            ],
            []
        ]
    },
    {
        "id": "40bb95a040e7d57b",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "svegliaCalda",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 950,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "02b158dae7c31f15",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_AwayTimer",
        "topic": ".topic",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 570,
        "y": 880,
        "wires": [
            [
                "db81084ddae30510"
            ]
        ]
    },
    {
        "id": "db81084ddae30510",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hvacAway",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 880,
        "wires": [
            []
        ]
    },
    {
        "id": "a336d47a71e5c5eb",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Away_check",
        "topic": ".topic",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": false,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 530,
        "y": 940,
        "wires": [
            [
                "a2a8d5cab70abd7d"
            ]
        ]
    },
    {
        "id": "a2a8d5cab70abd7d",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "hvacaway",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "f371eb169aabd774",
        "type": "function",
        "z": "12045cd3287d8a9f",
        "name": "Ricava ora",
        "func": "// Ottieni la data e l'ora corrente\nlet currentDate = new Date();\n\n// Calcola il fuso orario di Roma\nlet offset = currentDate.getTimezoneOffset(); // Differenza UTC in minuti\nlet romeTime = new Date(currentDate.getTime() + offset * 60000 + 3600000); // CET (UTC+1)\n\n// Aggiusta per l'ora legale (CEST)\nlet isDST = romeTime.getMonth() > 2 && romeTime.getMonth() < 10 && \n            (romeTime.getMonth() > 2 || (romeTime.getMonth() === 2 && romeTime.getDate() - romeTime.getDay() >= 25)) && \n            (romeTime.getMonth() < 9 || (romeTime.getMonth() === 9 && romeTime.getDate() - romeTime.getDay() < 25));\nif (isDST) {\n    romeTime = new Date(romeTime.getTime() + 3600000); // CEST (UTC+2)\n}\n\n// Estrai solo le ore\nlet currentHour = romeTime.getHours();\n\n// Output\nmsg.payload = currentHour;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 690,
        "y": 60,
        "wires": [
            [
                "adf6b676a408a8e1"
            ]
        ]
    },
    {
        "id": "8ecc119e9baa58ad",
        "type": "inject",
        "z": "12045cd3287d8a9f",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "60",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 450,
        "y": 60,
        "wires": [
            [
                "f371eb169aabd774"
            ]
        ]
    },
    {
        "id": "adf6b676a408a8e1",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "setOre",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 910,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "0a5d794745789153",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Soggiorno",
        "topic": ".topic",
        "initialstate": true,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 590,
        "y": 1160,
        "wires": [
            [
                "45d148b0d28eaac5"
            ]
        ]
    },
    {
        "id": "b0ee030281c19d66",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Letto",
        "topic": ".topic",
        "initialstate": true,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 570,
        "y": 1220,
        "wires": [
            [
                "8789fa4250f6fe77"
            ]
        ]
    },
    {
        "id": "6118ac2bb890f99d",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Cameretta",
        "topic": ".topic",
        "initialstate": true,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 590,
        "y": 1280,
        "wires": [
            [
                "2377582bac9e2a23"
            ]
        ]
    },
    {
        "id": "29b4ee842ddeca29",
        "type": "openhab2-in2",
        "z": "12045cd3287d8a9f",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Studio",
        "topic": ".topic",
        "initialstate": true,
        "whenupdated": false,
        "whencommand": true,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 580,
        "y": 1340,
        "wires": [
            [
                "b68f2fe7a8cbc1ae"
            ]
        ]
    },
    {
        "id": "45d148b0d28eaac5",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "statoCond1",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 1160,
        "wires": [
            []
        ]
    },
    {
        "id": "8789fa4250f6fe77",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "statoCond2",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 890,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "2377582bac9e2a23",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "statoCond3",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 1280,
        "wires": [
            []
        ]
    },
    {
        "id": "b68f2fe7a8cbc1ae",
        "type": "change",
        "z": "12045cd3287d8a9f",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "statoCond4",
                "pt": "global",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 1340,
        "wires": [
            []
        ]
    },
    {
        "id": "36d9f01b580873b0",
        "type": "ui_template",
        "z": "797c1ab8f59de950",
        "group": "edd62308.5b6eb",
        "name": "css etc",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n\n.filled { height: 48px !important;padding: 0 !important; margin: 0 !important;}\n.nr-dashboard-template { padding: 0; margin: 0; background-color:black}\n.rounded { border-radius: 12px 12px 12px 12px;}\n.bigfont { font-size: 18px;}\n.smallfont { font-size: 12px;}\n.thedays { cursor:pointer; vertical-align:bottom; height:48px; }\n.the2px  { background-color: #9E9E9E; height:2px; }\n.theblocks {width:100%; height:0%; background-color:#4CAF50; }\n.greybuttons { background-color:#cecac536 !important; width:48px; border: none;}\n.thetemps { cursor:pointer; font-size:50%; color:#9E9E9E !important; } // Size caratteri temp\n.smallheadings { color:blue; font-size:100%; }\n\n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 200,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "0524b5bb03a50ed1",
        "type": "ui_template",
        "z": "797c1ab8f59de950",
        "group": "edd62308.5b6eb",
        "name": "Settings page",
        "order": 1,
        "width": "0",
        "height": "0",
        "format": "<script>\nvar thedays=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\nvar ID = \"AA\";\n\nvar last=29;\n\nfunction bar(mm,val)\n{\nif (val==14) { $(mm).height(\"12%\"); $(mm).css('background-color', '#1E88E5'); } //blue\nif (val==15) { $(mm).height(\"16%\"); $(mm).css('background-color', '#039BE5'); }\nif (val==16) { $(mm).height(\"20%\"); $(mm).css('background-color', '#00ACC1'); } \nif (val==17) { $(mm).height(\"24%\"); $(mm).css('background-color', '#039BE5'); } // cyan\nif (val==18) { $(mm).height(\"28%\"); $(mm).css('background-color', '#00ACC1'); }\nif (val==19) { $(mm).height(\"32%\"); $(mm).css('background-color', '#00897B'); } \nif (val==19.5) { $(mm).height(\"34%\"); $(mm).css('background-color', '#00897B'); }\nif (val==20) { $(mm).height(\"36%\"); $(mm).css('background-color', '#388E3C'); } // green\nif (val==20.5) { $(mm).height(\"38%\"); $(mm).css('background-color', '#388E3C'); }\nif (val==21) { $(mm).height(\"40%\"); $(mm).css('background-color', '#689F38'); }\nif (val==21.5) { $(mm).height(\"42%\"); $(mm).css('background-color', '#689F38'); }\nif (val==22) { $(mm).height(\"44%\"); $(mm).css('background-color', '#C0CA33'); }\nif (val==23) { $(mm).height(\"48%\"); $(mm).css('background-color', '#FDD835'); } // yellow\nif (val==24) { $(mm).height(\"52%\"); $(mm).css('background-color', '#FBC02D'); }\nif (val==25) { $(mm).height(\"56%\"); $(mm).css('background-color', '#FFA000'); }\nif (val==26) { $(mm).height(\"60%\"); $(mm).css('background-color', '#E64A19'); } // red\n    \n}\n\nfunction stat(text)\n{\n$(\"#info\"+ID).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID).text(\"Ok\"); clearTimeout(tm);}, 5000); //Tempo permanenza selezione\n}\n\nfunction selec(val,sta)\n{\nvar w=\"#td\"+val+ID;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n    (function(scope){\n        scope.ID = ID;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec(last,0); last=msg.selector; selec(last,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID; bar(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID; $(v).text(msg.timing[((msg.days-1)*24)+x]+\"°\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\"+ID).text(thedays[msg.days-1]);\n             if ((last>4) &&(last<29))\n                 $(\"#current\"+ID).text(msg.timing[((msg.days-1)*24)+last-5] + \"°\");\n             else\n                 $(\"#current\"+ID).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" style=\"color:red\" >Giorno</span></center></td>\n     <!--   <td colspan=3><center><span class=\"smallheadings\">Clima AUTO</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td> -->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID }}\" style=\"cursor:pointer;color:red;font-size:120%\">LUNEDI</span></center></td>\n     <!--   <td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:blue;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:blue;font-size:120%\">20</span></center></td> -->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td> \n     <!--   <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td> -->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\" style=\"color:red\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID }}\" class=\"smallheadings\" style=\"color:red\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\">\n                    <md-tooltip md-direction=\"bottom\">DECREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID }}\" style=\"color:red;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\">\n                    <md-tooltip md-direction=\"bottom\">INCREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 480,
        "y": 140,
        "wires": [
            [
                "eea84621da24bc47"
            ]
        ]
    },
    {
        "id": "eea84621da24bc47",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "Process controls",
        "func": "if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=29;\nif ( typeof context.saving == 'undefined' ) context.saving=1;\nif (typeof context.global.timing == 'undefined') {\n    context.global.timing=[\n        18,18,18,18,18,18,18,18,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        6,14\n    ];\n        context.saving=1;                 \n}\nvar timing = context.global.timing;\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>1)&&(context.selector<29))\n                {\n                   timing[((context.days-1)*24)+(context.selector-5)] += 0.5; \n                    if (timing[((context.days-1)*24)+context.selector-5]>26){ timing[((context.days-1)*24)+context.selector-5]=26; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura aumentata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Temperatura clima aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[169+(context.selector-1)]<26) {  timing[169+(context.selector-1)]++; msg.foryou=\"Temperatura fuori casa aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) { msg.foryou=\"Giorno successivo\"; context.days++; if (context.days>7) { context.days = 1; } }\n                break;\n    case \"d\" :  if ((context.selector>1)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5] -= 0.5; \n                    if (timing[((context.days-1)*24)+context.selector-5]<17){ timing[((context.days-1)*24)+context.selector-5]=17; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura decrementata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Temperatura clima diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[169+(context.selector-1)]>12) { timing[169+(context.selector-1)]--; msg.foryou=\"Temperatura fuori casa diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) {  msg.foryou=\"Giorno precedente\";  context.days--; if (context.days < 1) { context.days = 7;  } }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         timing[((context.days-1)*24)+context.selector-4]=timing[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Temperatura copiata nello slot successivo\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing[((context.days)*24)+a]=timing[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Temperatura clima selezionata\"; \n               else if (msg.payload=='2') msg.foryou=\"Temperatura fuori casa selezionata\";\n               else if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione temperatura ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 703,
        "y": 192,
        "wires": [
            [
                "c62584344beedb79"
            ],
            [
                "fc9c3537e962225f"
            ],
            [
                "4e76348501b0de5d"
            ]
        ]
    },
    {
        "id": "7338b30514606b09",
        "type": "inject",
        "z": "797c1ab8f59de950",
        "name": "Once only",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 390,
        "y": 240,
        "wires": [
            [
                "eea84621da24bc47",
                "838ae97e5275745f"
            ]
        ]
    },
    {
        "id": "fc9c3537e962225f",
        "type": "file",
        "z": "797c1ab8f59de950",
        "name": "backup",
        "filename": "/etc/openhab/nodered/data/scheduler.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 960,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "838ae97e5275745f",
        "type": "file in",
        "z": "797c1ab8f59de950",
        "name": "Restore",
        "filename": "/etc/openhab/nodered/data/scheduler.log",
        "filenameType": "str",
        "format": "utf8",
        "sendError": true,
        "encoding": "none",
        "allProps": false,
        "x": 700,
        "y": 280,
        "wires": [
            [
                "38c8eec1b4c6f79d"
            ]
        ]
    },
    {
        "id": "38c8eec1b4c6f79d",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "Restore data from SD",
        "func": "context.global.timing=JSON.parse(msg.payload);\nmsg.payload = context.global.timing;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 280,
        "wires": [
            [
                "84fd75c9bac70a02"
            ]
        ]
    },
    {
        "id": "f95517a76f48b04e",
        "type": "link in",
        "z": "797c1ab8f59de950",
        "name": "restoreSD",
        "links": [
            "84fd75c9bac70a02"
        ],
        "x": 541,
        "y": 192,
        "wires": [
            [
                "eea84621da24bc47"
            ]
        ]
    },
    {
        "id": "84fd75c9bac70a02",
        "type": "link out",
        "z": "797c1ab8f59de950",
        "name": "restoreSD",
        "links": [
            "f95517a76f48b04e"
        ],
        "x": 1055,
        "y": 280,
        "wires": []
    },
    {
        "id": "c62584344beedb79",
        "type": "link out",
        "z": "797c1ab8f59de950",
        "name": "setSettings",
        "links": [
            "187d6e6873b932a3"
        ],
        "x": 855,
        "y": 140,
        "wires": []
    },
    {
        "id": "187d6e6873b932a3",
        "type": "link in",
        "z": "797c1ab8f59de950",
        "name": "setSettings",
        "links": [
            "c62584344beedb79"
        ],
        "x": 347.5,
        "y": 140,
        "wires": [
            [
                "0524b5bb03a50ed1"
            ]
        ]
    },
    {
        "id": "15f74d7772f29ce4",
        "type": "comment",
        "z": "797c1ab8f59de950",
        "name": "EDIT",
        "info": "https://flows.nodered.org/flow/65f411e9e37745a4bbeef5926d052c97\n\nSettings page:\n-thedays2\n-ID2\n-last2\n-bar2\n-stat2\n-selec2\n\nProcess controls\n-days2\n-selector2\n-saving2\n-timing2\n-temperatures2\n\nRestore data from SD\n-timing2\n\nProcess heat\n-timing2\n\nBackup/Restore File read\nchange name of the file .log",
        "x": 150,
        "y": 40,
        "wires": []
    },
    {
        "id": "df2e4c078e2b8860",
        "type": "ui_text",
        "z": "797c1ab8f59de950",
        "group": "edd62308.5b6eb",
        "order": 4,
        "width": 2,
        "height": 1,
        "name": "Stato:",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-center",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 970,
        "y": 400,
        "wires": []
    },
    {
        "id": "2a15bc2e698c853f",
        "type": "ui_chart",
        "z": "797c1ab8f59de950",
        "name": "Chart",
        "group": "edd62308.5b6eb",
        "order": 7,
        "width": 6,
        "height": "3",
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "3",
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": "",
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 630,
        "y": 1000,
        "wires": [
            []
        ]
    },
    {
        "id": "7e7d2fd1f829e36a",
        "type": "ui_text",
        "z": "797c1ab8f59de950",
        "group": "edd62308.5b6eb",
        "order": 5,
        "width": 2,
        "height": 1,
        "name": "SetPoint:",
        "label": "",
        "format": "{{msg.payload| number:1}} °C",
        "layout": "row-right",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 900,
        "y": 1160,
        "wires": []
    },
    {
        "id": "ac5097ef55cd6009",
        "type": "inject",
        "z": "797c1ab8f59de950",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 160,
        "y": 520,
        "wires": [
            [
                "719ff8c63fd154ae"
            ]
        ]
    },
    {
        "id": "719ff8c63fd154ae",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "General var",
        "func": "var riscaldamentoModo=flow.get('riscaldamentoModo');\nvar setPointManuale=flow.get('setPointManuale');\nflow.set(\"riscaldamentoModo\", 1);\nflow.set(\"setPointManuale\", 20);\nflow.set(\"statorele\", 0);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 390,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "7a4b77032d7c22ad",
        "type": "ui_text",
        "z": "797c1ab8f59de950",
        "group": "edd62308.5b6eb",
        "order": 3,
        "width": 2,
        "height": 1,
        "name": "Modo:",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 670,
        "y": 580,
        "wires": []
    },
    {
        "id": "f8341463edd4e198",
        "type": "comment",
        "z": "797c1ab8f59de950",
        "name": "Relè caldaia",
        "info": "",
        "x": 1550,
        "y": 160,
        "wires": []
    },
    {
        "id": "8a9909970bc8a936",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "",
        "func": "let msg1 = {}; //switch \nlet msg2 = {}; //target temperature\nlet msg3 = {}; //current temperature\nlet msg4 = {}; //hysteresis\nlet now = new Date(msg.time);\nglobal.set(\"time\", now);\nlet setPointAuto\n\nlet riscaldamentoModo = global.get(\"riscaldamentoModo\");\nlet condizionamentoModo = global.get(\"condizionamentoModo\");\nlet setPointManuale = global.get(\"setPointManuale\");\nlet tempCurrent = global.get(\"tempCurrent\");\n//let timing = global.get(\"timing\");\nlet timing = context.global.timing\n\n//Lettura setpoint in base alla data/ora\nsetPointAuto = timing[(now.getDay() * 24) + now.getHours() - 1];\nglobal.set(\"setPointAuto\", setPointAuto);\n//msg.frost = timing[168];\n//msg.away = timing[169];\n\n// Payload per il termostato riscaldamento\nif (riscaldamentoModo == 1) {   //auto\n    msg1.topic = \"switch\"\n    msg1.payload = \"auto\"\n    msg1.time = now\n    msg2.topic = \"target\" // Temperature target\n    msg2.payload = setPointAuto\n    msg3.topic = \"current\"\n    msg3.payload = tempCurrent // Temperature current\n    msg4.topic = \"hysteresis\"\n    msg4.payload = 0.2\n}\nelse if (riscaldamentoModo == 2) { //Disattivo\n    msg1.topic = \"switch\"\n    msg1.payload = false\n    msg1.time = now\n    msg2.topic = \"target\"\n    msg2.payload = setPointAuto\n    msg3.topic = \"current\"\n    msg3.payload = tempCurrent\n    msg4.topic = \"hysteresis\"\n    msg4.payload = 0.2\n}\nelse if (riscaldamentoModo == 3) { //Manuale\n    msg1.topic = \"switch\"\n    msg1.payload = \"auto\"\n    msg1.time = now\n    msg2.topic = \"target\"\n    msg2.payload = setPointManuale\n    msg3.topic = \"current\"\n    msg3.payload = tempCurrent\n    msg4.topic = \"hysteresis\"\n    msg4.payload = 0.2\n}\nnode.status({ fill: \"green\", shape: \"dot\", text: riscaldamentoModo + \" SPA:\" + setPointAuto + \" SPM:\" + setPointManuale });\nreturn [[msg1, msg2, msg3, msg4]];",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 340,
        "wires": [
            [
                "ed95b3f8540ea9c3"
            ]
        ]
    },
    {
        "id": "8d22819ea32a5275",
        "type": "inject",
        "z": "797c1ab8f59de950",
        "name": "",
        "props": [
            {
                "p": "time",
                "v": "",
                "vt": "date"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 70,
        "y": 920,
        "wires": [
            [
                "33227c27106112b3"
            ]
        ]
    },
    {
        "id": "4e76348501b0de5d",
        "type": "link out",
        "z": "797c1ab8f59de950",
        "name": "setSettings",
        "links": [],
        "x": 855,
        "y": 220,
        "wires": []
    },
    {
        "id": "ed95b3f8540ea9c3",
        "type": "dynamic thermostat",
        "z": "797c1ab8f59de950",
        "name": "",
        "x": 510,
        "y": 340,
        "wires": [
            [
                "db30d838f7fbd524",
                "b9b3b3cd42ed4b7a"
            ]
        ]
    },
    {
        "id": "b3290766774cc9df",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "Caldaia",
        "controller": "eb6d7470c0839f99",
        "itemname": "FGS221_002_SwitchBinary2",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1060,
        "y": 820,
        "wires": [
            []
        ]
    },
    {
        "id": "c9fcdb4cf376c94b",
        "type": "moment",
        "z": "797c1ab8f59de950",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "Europe/Rome",
        "adjAmount": "1",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "Europe/Rome",
        "x": 190,
        "y": 340,
        "wires": [
            [
                "8a9909970bc8a936"
            ]
        ]
    },
    {
        "id": "c4c28f8e509d1539",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Studio",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1120,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "425a97af00a38cb4",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Soggiorno",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1130,
        "y": 540,
        "wires": [
            []
        ]
    },
    {
        "id": "92bfd1f580f425b4",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Letto",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1120,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "1023f96bb41be585",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Cameretta",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1130,
        "y": 660,
        "wires": [
            []
        ]
    },
    {
        "id": "b9b3b3cd42ed4b7a",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "",
        "func": "let riscaldamentoModo=global.get(\"riscaldamentoModo\");\nlet condizionamentoModo = global.get(\"hvacMode\");\nlet statoCaldaia=global.get(\"statoCaldaia\");\nlet setPointManuale=global.get(\"setPointManuale\");\nlet nsetPointManuale = parseInt(setPointManuale);\nlet statoAntifurto=global.get(\"statoAntifurto\");\nlet time=global.get(\"time\");\nlet setPointAuto=global.get(\"setPointAuto\");\nlet nsetPointAuto = parseInt(setPointAuto); \nlet riscaldamento;\nlet msg1 = {};\nlet msg2 = {};\nlet data = new Date(time);\nlet ore = data.getUTCHours();\nlet minuti = data.getUTCMinutes();\nlet secondi = data.getUTCSeconds();\nlet gSwCondPower=global.get(\"gSwCondPower\");\nlet riscaldamentoHvAC = global.get(\"riscaldamentoHvAC\");\n\n//msg invia il comando ON/OFF alla caldaia\n//msg1 invia il comando ON/OFF ai condizionatori\n//msg2 invia il setpoint ai condizionatori\n\nswitch (riscaldamentoModo) {\n    case \"1\":\n        riscaldamento = \"Automatico\";\n        node.status({ fill: \"green\", shape: \"dot\", text: \"In \" + riscaldamento  });\n        //node.status({text: time})\n        break;\n    case \"2\":\n        riscaldamento = \"Disattivo\";\n        node.status({ fill: \"red\", shape: \"dot\", text: \"In \" + riscaldamento  });\n        break;\n    case \"3\":\n        riscaldamento = \"Manuale\";\n        node.status({ fill: \"red\", shape: \"dot\", text: \"In \" + riscaldamento  });\n        break;\n}\n// Modo riscaldamento 1=AUTO, 2=DISATTIVATO, 3=MANUALE\nif ((msg.payload.onoff === true) && (riscaldamentoModo != 2)) { //Se il modo riscaldamento non è DISATTIVATO (2)\n    if ((ore >= 5) && (time < 7)) { \n        msg1.payload=\"ON\"; //Accende condizionatore\n        msg2.payload = (nsetPointAuto) //Se con + 1 Aggiunge un grado al setpoint Automatico per i condizionatori\n        return [null, msg1, msg2]\n    } \n    else if ((statoCaldaia == \"OFF\")) {\n        msg.payload = \"ON\" // Invia comando di accensione alla caldaia\n        if ((riscaldamentoModo == 3)) { //Modo Manuale\n            if ((riscaldamentoHvAC == 1 )) { //Se vengono richiesti anche i condizionatori\n                msg1.payload = \"ON\" //Invia comando di accensione ai condizionatori\n                msg2.payload = (nsetPointManuale ) //Se con + 1 Aggiunge un grado al setpoint manuale per i condizionatori\n                return [msg, msg1, msg2]\n            }\n            return [msg, null, null]\n        }\n        else { //Modo automatico\n            if ((riscaldamentoHvAC == 1)) { //Se vengono richiesti anche i condizionatori\n                msg1.payload = \"ON\" //Invia comando di accensione ai condizionatori\n                msg2.payload = (nsetPointAuto) // Se con + 1  Aggiunge un grado al setpoint automatico per i condizionatori\n                return [msg, msg1, msg2]\n            }\n            return [msg, null, null]            \n        }    \n    }\n//    else if ((statoCaldaia == \"ON\") && (riscaldamentoHvAC == 1) && (statoAntifurto == \"DISINSERITO\")) { //Caso in cui la modalità di riscaldamento prevede i condizionatori \n                                                                                                        // ma si sono spenti al momento dell'inserimento dell'antifurto\n//        msg1.payload = \"ON\" //Invia comando di accensione ai condizionatori\n//        msg2.payload = (nsetPointAuto) // Se con + 1  Aggiunge un grado al setpoint automatico per i condizionatori\n//        return [null, msg1, msg2]\n//    }\n}  \nelse if ((msg.payload.onoff === false)) {\n    if ((statoCaldaia == \"ON\")) {\n        msg.payload=\"OFF\";\n        if ((gSwCondPower == \"ON\") && (ore <= 7)) {\n            msg1.payload = \"OFF\"\n            return [msg, msg1, null];\n        }\n        else {\n            return [msg, null, null];  \n        }\n    }\n}\nreturn [null, null ,null]",
        "outputs": 3,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 340,
        "wires": [
            [],
            [],
            []
        ]
    },
    {
        "id": "11b264ed678014bf",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Cameretta",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1120,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "4a354a9249517231",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Letto",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1100,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "f5e410d9e188d687",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Soggiorno",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1120,
        "y": 1040,
        "wires": [
            []
        ]
    },
    {
        "id": "fb94f346a9422c73",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Studio",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1110,
        "y": 1100,
        "wires": [
            []
        ]
    },
    {
        "id": "db30d838f7fbd524",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "function 4",
        "func": "if (msg.payload.onoff === true) {\n    msg.payload.onoff= 'ACCESA'\n}\nelse msg.payload.onoff= 'SPENTA'\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 680,
        "y": 400,
        "wires": [
            []
        ]
    },
    {
        "id": "33227c27106112b3",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "",
        "func": "let msg1 = {}; //switch \nlet msg2 = {}; //target temperature\nlet msg3 = {}; //Set setHysteresisPlus\nlet msg4 = {}; //Set setHysteresisMinus\nlet now = new Date(msg.time); // legge l'ora dal msg.time\nglobal.set(\"time\", now);\nlet setPointAuto\n\nlet riscaldamentoModo = global.get(\"riscaldamentoModo\");\n//let condizionamentoModo = global.get(\"condizionamentoModo\");\nlet setPointManuale = global.get(\"setPointManuale\");\nlet tempCurrent = global.get(\"tempCurrent\");\n\n// Rimuovi tutto ciò che non è un numero o un separatore decimale\nlet tempNumber = parseFloat(tempCurrent.replace(',', '.').replace(/[^0-9.-]/g, ''));\n\n//let timing = global.get(\"timing\");\nlet timing = context.global.timing\n\n//Lettura setpoint in base alla data/ora\nsetPointAuto = timing[(now.getDay() * 24) + now.getHours() ];\nglobal.set(\"setPointAuto\", setPointAuto);\n\n// Payload per il termostato riscaldamento\nif (riscaldamentoModo == 1) {   //auto\n    msg1.topic = \"setCurrent\" // Topic per valore di temperatura attuale\n    msg1.payload = tempNumber // Valore di temperatura rilevato dal sensore\n    msg2.topic = \"setTarget\" // Topic per valore di temperatura programmato\n    msg2.payload = setPointAuto // Valore di temperatura previsto dalla programmazione\n    msg3.topic = \"setHysteresisPlus\"\n    msg3.payload = 0.1\n    msg4.topic = \"setHysteresisMinus\"\n    msg4.payload = 0.2\n    return [msg1, msg2, msg3, msg4];\n}\nelse if (riscaldamentoModo == 2) { //Disattivo\n    msg1.topic = \"setCurrent\"\n    msg1.payload = tempNumber // Valore di temperatura rilevato dal sensore\n    msg2.topic = \"setTarget\" // Topic per valore di temperatura programmato\n    msg2.payload = tempNumber // Valore di temperatura setpoint uguale alla temperatura corrente\n    msg3.topic = \"setHysteresisPlus\"\n    msg3.payload = 0\n    msg4.topic = \"setHysteresisMinus\"\n    msg4.payload = 0\n    return [msg1, msg2, msg3, msg4];\n}\nelse if (riscaldamentoModo == 3) { //Manuale\n    msg1.topic = \"setCurrent\"\n    msg1.payload = tempNumber // Valore di temperatura rilevato dal sensore\n    msg2.topic = \"setTarget\" // Topic per valore di temperatura programmato\n    msg2.payload = setPointManuale // Valore di temperatura previsto dalla programmazione\n    msg3.topic = \"setHysteresisPlus\"\n    msg3.payload = 0.1\n    msg4.topic = \"setHysteresisMinus\"\n    msg4.payload = 0.2\n    return [msg1, msg2, msg3, msg4];\n}\n//node.status({ fill: \"green\", shape: \"dot\", text: riscaldamentoModo + \" SPA:\" + setPointAuto + \" SPM:\" + setPointManuale });\n",
        "outputs": 4,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 220,
        "y": 920,
        "wires": [
            [
                "96ccccad3ceb3a0a"
            ],
            [
                "96ccccad3ceb3a0a",
                "9d6b5b5d5ea18a63"
            ],
            [
                "96ccccad3ceb3a0a"
            ],
            [
                "96ccccad3ceb3a0a"
            ]
        ]
    },
    {
        "id": "96ccccad3ceb3a0a",
        "type": "ramp-thermostat",
        "z": "797c1ab8f59de950",
        "name": "",
        "profile": "29361ffb5398d62e",
        "hysteresisplus": "0.1",
        "hysteresisminus": "0.1",
        "x": 430,
        "y": 920,
        "wires": [
            [
                "43775e415e2e7869",
                "9e4b887668fb7f2b"
            ],
            [
                "2a15bc2e698c853f",
                "8c4750ea5bf6dbf3"
            ],
            []
        ]
    },
    {
        "id": "bb885a7b4bc2b9fb",
        "type": "openhab2-in2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_Modo",
        "topic": "",
        "initialstate": false,
        "whenupdated": false,
        "whencommand": false,
        "whenchanged": true,
        "changedfrom": "",
        "changedto": "",
        "x": 160,
        "y": 580,
        "wires": [
            [
                "dabb58d6e56274be"
            ]
        ]
    },
    {
        "id": "dabb58d6e56274be",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "Controllo Tipo",
        "func": "if (msg.payload == 1) {\n    msg.payload = \"AUTO\"\n}\nelse if (msg.payload == 2) {\n    msg.payload = \"DIS\"\n}\nelse if (msg.payload == 3) {\n    msg.payload = \"MAN\"\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 580,
        "wires": [
            [
                "7a4b77032d7c22ad"
            ]
        ]
    },
    {
        "id": "8c4750ea5bf6dbf3",
        "type": "ui_gauge",
        "z": "797c1ab8f59de950",
        "name": "Gauge",
        "group": "edd62308.5b6eb",
        "order": 6,
        "width": "6",
        "height": "3",
        "gtype": "gage",
        "title": "Corridoio",
        "label": "°C",
        "format": "{{msg.payload| number:1}} °C",
        "min": "15",
        "max": "30",
        "colors": [
            "#162ee3",
            "#01ef50",
            "#ca3838"
        ],
        "seg1": "18",
        "seg2": "25",
        "diff": false,
        "className": "",
        "x": 630,
        "y": 960,
        "wires": []
    },
    {
        "id": "77733385612fe95c",
        "type": "comment",
        "z": "797c1ab8f59de950",
        "name": "",
        "info": "Parte vecchia da eliminare",
        "x": 480,
        "y": 360,
        "wires": []
    },
    {
        "id": "43775e415e2e7869",
        "type": "function",
        "z": "797c1ab8f59de950",
        "name": "function 6",
        "func": "// Nodo Funzione Node-RED\n\n// Variabili globali da utilizzare\nlet riscaldamentoModo = global.get('riscaldamentoModo') || 2; // Modalità riscaldamento automatico (1) o manuale (3) o disabilitato (2)\nlet riscaldamentoHvAC = global.get('riscaldamentoHvAC') || 0; // Modalità riscaldamento HVAC 0=GAS ONLY, 1=GAS+ENE\nlet setPointAuto = global.get('setPointAuto') || 20; // Setpoint automatico\nlet setPointManuale = global.get('setPointManuale') || 22; // Setpoint manuale\nlet ore = global.get(\"setOre\") //ora di Roma con cambio ora legale automatico\n\n// Stato attuale dei dispositivi\nlet statoCond1 = global.get('statoCond1') || \"OFF\";\nlet statoCond2 = global.get('statoCond2') || \"OFF\";\nlet statoCond3 = global.get('statoCond3') || \"OFF\";\nlet statoCond4 = global.get('statoCond4') || \"OFF\";\nlet statoCaldaia = global.get('statoCaldaia') || \"OFF\";\n\n// Input dal messaggio\nconst consenso = msg.payload === true; // Consenso del cronotermostato\n\n// Calcolo degli stati degli output\nlet outputCond1 = null;\nlet outputCond2 = null;\nlet outputCond3 = null;\nlet outputCond4 = null;\nlet outputCaldaia = null;\nlet outputSetPoint = null;\n\n// Logica per i condizionatori (out1, out2, out3, out4)\nif (riscaldamentoHvAC == 1 && riscaldamentoModo != 2 && consenso && setPointAuto != 18) {\n    if (statoCond1 !== \"ON\") {\n        outputCond1 = { payload: \"ON\" };\n    }\n    if (statoCond2 !== \"ON\") {\n        outputCond2 = { payload: \"ON\" };\n    }\n    if (statoCond3 !== \"ON\") {\n        outputCond3 = { payload: \"ON\" };\n    }\n    if (statoCond4 !== \"ON\") {\n        outputCond4 = { payload: \"ON\" };\n    }\n}\nelse if ((ore > 23 || setPointAuto == 18) && riscaldamentoModo != 2 ) { //se dopo 23 o con setpoint_auto = 18 ma solo se la modalità è diversa da disattivato\n    if (statoCond1 !== \"OFF\") {\n        outputCond1 = { payload: \"OFF\" };\n    }\n    if (statoCond2 !== \"OFF\") {\n        outputCond2 = { payload: \"OFF\" };\n    }\n    if (statoCond3 !== \"OFF\") {\n        outputCond3 = { payload: \"OFF\" };\n    }\n    if (statoCond4 !== \"OFF\") {\n        outputCond4 = { payload: \"OFF\" };\n    }\n}\n\n// Logica per la caldaia (out5)\nif (riscaldamentoModo != 2 && consenso) {\n    if (statoCaldaia !== \"ON\") {\n        outputCaldaia = { payload: \"ON\" };\n    }\n} else {\n    if (statoCaldaia !== \"OFF\") {\n        outputCaldaia = { payload: \"OFF\" };\n    }\n}\n\n// Logica per il setpoint (out6)\nif (consenso) {\n    if (riscaldamentoModo == 1) {\n        outputSetPoint = { payload: setPointAuto };\n    } else if (riscaldamentoModo == 3) {\n        outputSetPoint = { payload: setPointManuale };\n    } else {\n        outputSetPoint = { payload: null };\n    }\n}\n\nnode.status({ fill: \"red\", shape: \"dot\", text: \"consenso \" + consenso + \" riscaldamentoHvAC: \" + riscaldamentoHvAC + \" riscaldamentoModo \" + riscaldamentoModo});\n\n// Invio degli output\nreturn [outputCond1, outputCond2, outputCond3, outputCond4, outputCaldaia, outputSetPoint];",
        "outputs": 6,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 760,
        "y": 920,
        "wires": [
            [
                "425a97af00a38cb4"
            ],
            [
                "92bfd1f580f425b4"
            ],
            [
                "1023f96bb41be585"
            ],
            [
                "c4c28f8e509d1539",
                "aa8199a76e279b5d"
            ],
            [
                "b3290766774cc9df",
                "df2e4c078e2b8860"
            ],
            [
                "78dcc3042da10b3d"
            ]
        ]
    },
    {
        "id": "9e4b887668fb7f2b",
        "type": "debug",
        "z": "797c1ab8f59de950",
        "name": "debug 25",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 660,
        "y": 840,
        "wires": []
    },
    {
        "id": "78dcc3042da10b3d",
        "type": "rbe",
        "z": "797c1ab8f59de950",
        "name": "",
        "func": "rbe",
        "gap": "",
        "start": "",
        "inout": "out",
        "septopics": true,
        "property": "payload",
        "topi": "topic",
        "x": 750,
        "y": 1080,
        "wires": [
            [
                "11b264ed678014bf",
                "4a354a9249517231",
                "f5e410d9e188d687",
                "fb94f346a9422c73",
                "7e7d2fd1f829e36a"
            ]
        ]
    },
    {
        "id": "9d6b5b5d5ea18a63",
        "type": "openhab2-out2",
        "z": "797c1ab8f59de950",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "Riscaldamento_Auto_SP",
        "topic": "ItemUpdate",
        "payload": "",
        "onlywhenchanged": true,
        "x": 390,
        "y": 680,
        "wires": [
            []
        ]
    },
    {
        "id": "aa8199a76e279b5d",
        "type": "debug",
        "z": "797c1ab8f59de950",
        "name": "debug 26",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 1260,
        "y": 800,
        "wires": []
    },
    {
        "id": "1276aff08cc2101a",
        "type": "ui_template",
        "z": "668d0f6536d63ae6",
        "group": "601993d289b1de60",
        "name": "css etc",
        "order": 2,
        "width": 0,
        "height": 0,
        "format": "<style>\n\n.filled { height: 48px !important;padding: 0 !important; margin: 0 !important;}\n.nr-dashboard-template { padding: 0; margin: 0; background-color:black}\n.rounded { border-radius: 12px 12px 12px 12px;}\n.bigfont { font-size: 18px;}\n.smallfont { font-size: 12px;}\n.thedays { cursor:pointer; vertical-align:bottom; height:48px; }\n.the2px  { background-color: #9E9E9E; height:2px; }\n.theblocks {width:100%; height:0%; background-color:#4CAF50; }\n.greybuttons { background-color:#cecac536 !important; width:48px; border: none;}\n.thetemps { cursor:pointer; font-size:70%; color:#9E9E9E !important; }\n.smallheadings { color:blue; font-size:100%; }\n\n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 400,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "0723be0d595d9193",
        "type": "ui_template",
        "z": "668d0f6536d63ae6",
        "group": "601993d289b1de60",
        "name": "Settings page",
        "order": 1,
        "width": 0,
        "height": 0,
        "format": "<script>\nvar thedays=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\nvar ID = \"AA\";\n\nvar last=29;\n\nfunction bar(mm,val)\n{\nif (val==14) { $(mm).height(\"12%\"); $(mm).css('background-color', '#1E88E5'); } //blue\nif (val==15) { $(mm).height(\"16%\"); $(mm).css('background-color', '#039BE5'); }\nif (val==16) { $(mm).height(\"20%\"); $(mm).css('background-color', '#00ACC1'); } \nif (val==17) { $(mm).height(\"24%\"); $(mm).css('background-color', '#039BE5'); } // cyan\nif (val==18) { $(mm).height(\"28%\"); $(mm).css('background-color', '#00ACC1'); }\nif (val==19) { $(mm).height(\"32%\"); $(mm).css('background-color', '#00897B'); } \nif (val==20) { $(mm).height(\"36%\"); $(mm).css('background-color', '#388E3C'); } // green\nif (val==21) { $(mm).height(\"40%\"); $(mm).css('background-color', '#689F38'); }\nif (val==22) { $(mm).height(\"44%\"); $(mm).css('background-color', '#C0CA33'); }\nif (val==23) { $(mm).height(\"48%\"); $(mm).css('background-color', '#FDD835'); } // yellow\nif (val==24) { $(mm).height(\"52%\"); $(mm).css('background-color', '#FBC02D'); }\nif (val==25) { $(mm).height(\"56%\"); $(mm).css('background-color', '#FFA000'); }\nif (val==26) { $(mm).height(\"60%\"); $(mm).css('background-color', '#E64A19'); } // red\n    \n}\n\nfunction stat(text)\n{\n$(\"#info\"+ID).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID).text(\"Ok\"); clearTimeout(tm);}, 5000); //Tempo permanenza selezione\n}\n\nfunction selec(val,sta)\n{\nvar w=\"#td\"+val+ID;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n    (function(scope){\n        scope.ID = ID;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec(last,0); last=msg.selector; selec(last,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID; bar(w,msg.hvacWinterTiming[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID; $(v).text(msg.hvacWinterTiming[((msg.days-1)*24)+x]+\"°\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID; $(w).text(msg.hvacWinterTiming[168+x]); }\n             $(\"#d0\"+ID).text(thedays[msg.days-1]);\n             if ((last>4) &&(last<29))\n                 $(\"#current\"+ID).text(msg.hvacWinterTiming[((msg.days-1)*24)+last-5] + \"°\");\n             else\n                 $(\"#current\"+ID).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" style=\"color:red\" >Giorno</span></center></td>\n     <!--   <td colspan=3><center><span class=\"smallheadings\">Clima AUTO</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td> -->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID }}\" style=\"cursor:pointer;color:red;font-size:120%\">LUNEDI</span></center></td>\n     <!--   <td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:blue;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:blue;font-size:120%\">20</span></center></td> -->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td> \n     <!--   <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td> -->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\" style=\"color:red\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID }}\" class=\"smallheadings\" style=\"color:red\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\">\n                    <md-tooltip md-direction=\"bottom\">DECREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID }}\" style=\"color:red;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\">\n                    <md-tooltip md-direction=\"bottom\">INCREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "resendOnRefresh": false,
        "templateScope": "local",
        "className": "",
        "x": 480,
        "y": 140,
        "wires": [
            [
                "f7f1014fc9b8c53a"
            ]
        ]
    },
    {
        "id": "f7f1014fc9b8c53a",
        "type": "function",
        "z": "668d0f6536d63ae6",
        "name": "Process controls",
        "func": "if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=29;\nif ( typeof context.saving == 'undefined' ) context.saving=1;\nif (typeof context.global.hvacWinterTiming == 'undefined') {\n    context.global.hvacWinterTiming=[\n        18,18,18,18,18,18,18,18,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n        6,14\n    ];\n        context.saving=1;                 \n}\nvar hvacWinterTiming = context.global.hvacWinterTiming;\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>1)&&(context.selector<29))\n                {\n                   hvacWinterTiming[((context.days-1)*24)+(context.selector-5)]++; \n                    if (hvacWinterTiming[((context.days-1)*24)+context.selector-5]>26){ hvacWinterTiming[((context.days-1)*24)+context.selector-5]=26; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura aumentata\";\n                }\n                if (context.selector==1) { if (hvacWinterTiming[168+(context.selector-1)]<26) {  hvacWinterTiming[168+(context.selector-1)]++; msg.foryou=\"Temperatura clima aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (hvacWinterTiming[169+(context.selector-1)]<26) {  hvacWinterTiming[169+(context.selector-1)]++; msg.foryou=\"Temperatura fuori casa aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) { msg.foryou=\"Giorno successivo\"; context.days++; if (context.days>7) { context.days = 1; } }\n                break;\n    case \"d\" :  if ((context.selector>1)&&(context.selector<29))\n                {\n                    hvacWinterTiming[((context.days-1)*24)+context.selector-5]--; \n                    if (hvacWinterTiming[((context.days-1)*24)+context.selector-5]<18){ hvacWinterTiming[((context.days-1)*24)+context.selector-5]=18; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura decrementata\";\n                }\n                if (context.selector==1) { if (hvacWinterTiming[168+(context.selector-1)]>12) { hvacWinterTiming[168+(context.selector-1)]--; msg.foryou=\"Temperatura clima diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (hvacWinterTiming[169+(context.selector-1)]>12) { hvacWinterTiming[169+(context.selector-1)]--; msg.foryou=\"Temperatura fuori casa diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) {  msg.foryou=\"Giorno precedente\";  context.days--; if (context.days < 1) { context.days = 7;  } }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         hvacWinterTiming[((context.days-1)*24)+context.selector-4]=hvacWinterTiming[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Temperatura copiata nello slot successivo\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             hvacWinterTiming[((context.days)*24)+a]=hvacWinterTiming[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Temperatura clima selezionata\"; \n               else if (msg.payload=='2') msg.foryou=\"Temperatura fuori casa selezionata\";\n               else if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione temperatura ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.hvacWinterTiming=hvacWinterTiming;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.hvacWinterTiming=\"\";\n        msg.payload=JSON.stringify(hvacWinterTiming);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 703,
        "y": 192,
        "wires": [
            [
                "c3de355a043646b0"
            ],
            [
                "a6d2d068cc3f4c33"
            ],
            [
                "e916a0ad779b17dd"
            ]
        ]
    },
    {
        "id": "9431faa00e34ed69",
        "type": "inject",
        "z": "668d0f6536d63ae6",
        "name": "Once only",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 390,
        "y": 240,
        "wires": [
            [
                "f7f1014fc9b8c53a",
                "0661e15a6c4bc0ed"
            ]
        ]
    },
    {
        "id": "a6d2d068cc3f4c33",
        "type": "file",
        "z": "668d0f6536d63ae6",
        "name": "backup",
        "filename": "/etc/openhab/nodered/data/CondWinterSchedule.log",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 960,
        "y": 180,
        "wires": [
            []
        ]
    },
    {
        "id": "0661e15a6c4bc0ed",
        "type": "file in",
        "z": "668d0f6536d63ae6",
        "name": "Restore",
        "filename": "/etc/openhab/nodered/data/CondWinterSchedule.log",
        "filenameType": "str",
        "format": "utf8",
        "sendError": true,
        "encoding": "none",
        "allProps": false,
        "x": 700,
        "y": 280,
        "wires": [
            [
                "2fec9e9396943773"
            ]
        ]
    },
    {
        "id": "2fec9e9396943773",
        "type": "function",
        "z": "668d0f6536d63ae6",
        "name": "Restore data from SD",
        "func": "context.global.hvacWinterTiming=JSON.parse(msg.payload);\nmsg.payload = context.global.hvacWinterTiming;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 900,
        "y": 280,
        "wires": [
            [
                "763400e554831581"
            ]
        ]
    },
    {
        "id": "ba62b0ddff7a73df",
        "type": "link in",
        "z": "668d0f6536d63ae6",
        "name": "restoreSD",
        "links": [
            "763400e554831581"
        ],
        "x": 541,
        "y": 192,
        "wires": [
            [
                "f7f1014fc9b8c53a"
            ]
        ]
    },
    {
        "id": "763400e554831581",
        "type": "link out",
        "z": "668d0f6536d63ae6",
        "name": "restoreSD",
        "links": [
            "ba62b0ddff7a73df"
        ],
        "x": 1055,
        "y": 280,
        "wires": []
    },
    {
        "id": "c3de355a043646b0",
        "type": "link out",
        "z": "668d0f6536d63ae6",
        "name": "setSettings",
        "links": [
            "f930e1c3d14e162d"
        ],
        "x": 855,
        "y": 140,
        "wires": []
    },
    {
        "id": "f930e1c3d14e162d",
        "type": "link in",
        "z": "668d0f6536d63ae6",
        "name": "setSettings",
        "links": [
            "c3de355a043646b0"
        ],
        "x": 347.5,
        "y": 140,
        "wires": [
            [
                "0723be0d595d9193"
            ]
        ]
    },
    {
        "id": "1ca4f967b6e5c738",
        "type": "comment",
        "z": "668d0f6536d63ae6",
        "name": "EDIT",
        "info": "https://flows.nodered.org/flow/65f411e9e37745a4bbeef5926d052c97\n\nSettings page:\n-thedays2\n-ID2\n-last2\n-bar2\n-stat2\n-selec2\n\nProcess controls\n-days2\n-selector2\n-saving2\n-hvacWinterTiming2\n-temperatures2\n\nRestore data from SD\n-hvacWinterTiming2\n\nProcess heat\n-hvacWinterTiming2\n\nBackup/Restore File read\nchange name of the file .log",
        "x": 150,
        "y": 40,
        "wires": []
    },
    {
        "id": "fb022001fd4b54bf",
        "type": "ui_gauge",
        "z": "668d0f6536d63ae6",
        "name": "Gauge",
        "group": "601993d289b1de60",
        "order": 6,
        "width": "6",
        "height": "3",
        "gtype": "gage",
        "title": "Corridoio",
        "label": "°C",
        "format": "{{msg.tempCurrent | number:1}} °C",
        "min": "15",
        "max": "30",
        "colors": [
            "#162ee3",
            "#01ef50",
            "#ca3838"
        ],
        "seg1": "18",
        "seg2": "25",
        "diff": false,
        "className": "",
        "x": 1050,
        "y": 660,
        "wires": []
    },
    {
        "id": "30e6f05189d8c5ed",
        "type": "ui_text",
        "z": "668d0f6536d63ae6",
        "group": "601993d289b1de60",
        "order": 4,
        "width": 2,
        "height": 1,
        "name": "Stato:",
        "label": "",
        "format": "{{msg.command}}",
        "layout": "row-center",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1050,
        "y": 780,
        "wires": []
    },
    {
        "id": "e55f1a8a3e4f2868",
        "type": "ui_chart",
        "z": "668d0f6536d63ae6",
        "name": "Chart",
        "group": "601993d289b1de60",
        "order": 7,
        "width": 6,
        "height": "3",
        "label": "",
        "chartType": "line",
        "legend": "false",
        "xformat": "HH:mm:ss",
        "interpolate": "linear",
        "nodata": "",
        "dot": false,
        "ymin": "",
        "ymax": "",
        "removeOlder": "3",
        "removeOlderPoints": "",
        "removeOlderUnit": "3600",
        "cutout": "",
        "useOneColor": false,
        "useUTC": false,
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "outputs": 1,
        "useDifferentColor": false,
        "className": "",
        "x": 1050,
        "y": 700,
        "wires": [
            []
        ]
    },
    {
        "id": "8915839519e16fe5",
        "type": "ui_text",
        "z": "668d0f6536d63ae6",
        "group": "601993d289b1de60",
        "order": 5,
        "width": 2,
        "height": 1,
        "name": "SetPoint:",
        "label": "",
        "format": "{{msg.setpoint | number:1}} °C",
        "layout": "row-right",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1060,
        "y": 740,
        "wires": []
    },
    {
        "id": "3b7c9f9834bcb3ad",
        "type": "inject",
        "z": "668d0f6536d63ae6",
        "name": "",
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": "",
        "topic": "",
        "payload": "Started!",
        "payloadType": "str",
        "x": 120,
        "y": 600,
        "wires": [
            [
                "c52caa9ae884ca10"
            ]
        ]
    },
    {
        "id": "c52caa9ae884ca10",
        "type": "function",
        "z": "668d0f6536d63ae6",
        "name": "General var",
        "func": "var riscaldamentoModo=flow.get('riscaldamentoModo');\nvar setPointManuale=flow.get('setPointManuale');\nflow.set(\"riscaldamentoModo\", 1);\nflow.set(\"setPointManuale\", 20);\nflow.set(\"statorele\", 0);",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "b4d9a216aa3d7c0c",
        "type": "ui_text",
        "z": "668d0f6536d63ae6",
        "group": "601993d289b1de60",
        "order": 3,
        "width": 2,
        "height": 1,
        "name": "Modo:",
        "label": "",
        "format": "{{msg.hvACWinterModeInt}}",
        "layout": "row-left",
        "className": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "x": 1050,
        "y": 820,
        "wires": []
    },
    {
        "id": "b1e8820252c1e3a9",
        "type": "function",
        "z": "668d0f6536d63ae6",
        "name": "",
        "func": "let now = new Date(msg.time);\nglobal.set(\"time\", now);\nlet hvACMode = global.get(\"hvacMode\"); // 1=Inverno, 2=Estate\nlet hvACWinterMode = global.get(\"hvacWinterMode\"); //HVAC Modo condizionamento Invernale 1=AUTO, 2=DIS, 3=MAN\nlet hvACSetPointWinterAuto; // SetPoint Winter Auto\nlet hvACSetPointWinterManual = global.get(\"setPointHvacManual\"); //SetPoint Invernale Manuale\nlet tempCurrent = global.get(\"tempCurrent\");\nlet tempCurrentInt = parseInt(tempCurrent)\nlet hvACWinterTiming = context.global.hvacWinterTiming\nlet hvACModeInt = parseInt(hvACMode);\nlet hvACWinterModeInt = parseInt(hvACWinterMode);\nlet statoAntifurto=global.get(\"statoAntifurto\");\nlet controllo1\nif (controllo1===undefined) {controllo1=\"false\"};\n\n//Lettura setpoint in base alla data/ora\nhvACSetPointWinterAuto = hvACWinterTiming[(now.getDay() * 24) + now.getHours() - 1];\nglobal.set(\"hvACSetPointWinterAuto\", hvACSetPointWinterAuto);\n\nswitch (hvACModeInt) { //Verifica in quale stagione siamo\n    case 1: //Inverno\n        msg.topic = \"Inverno\"\n       // node.status({ fill: \"red\", shape: \"dot\", text: \"hvACModeInt \" + hvACModeInt +   \" tempCurrent \" + tempCurrentInt + \" hvACSetPointWinterAuto \" + hvACSetPointWinterAuto});\n        switch (hvACWinterModeInt) { //Verifica della modalità impostata\n            case 1: //auto\n               //  msg.hvACWinterModeInt = \"AUTO\"\n                if (tempCurrentInt < hvACSetPointWinterAuto && statoAntifurto == \"DISINSERITO\" && controllo1 ==  \"false\") { \n                    msg.command = \"ON\"; //Se la temperature corrente è minore di quella impostata accende\n                    controllo1 = \"true\";\n                    msg.case = 1.1;\n                    msg.controllo1 = controllo1;\n                //    node.status({ fill: \"red\", shape: \"dot\", text: \"controllo: \" + controllo});\n                }\n                else if (controllo1 == \"true\") { \n                    msg.command = \"OFF\";\n                    controllo1 = \"false\";\n                    msg.case = 1.2;\n                 //   node.status({ fill: \"red\", shape: \"dot\", text: \"controllo: \" + controllo}); \n                };\n            break;\n            case 2: // disattivo\n               // msg.hvACWinterModeInt = \"DISATTIVO\"\n                msg.command = \"OFF\";\n                controllo1 = \"false\"\n                msg.case = 2.1\n            break;\n            case 3: //manuale\n               // msg.hvACWinterModeInt = \"MANUALE\"\n                if ((tempCurrentInt < hvACSetPointWinterAuto) && (statoAntifurto == \"DISINSERITO\") && (controllo1 == \"false\")) {\n               //     msg.command = \"ON\";\n                    controllo1 = \"true\";\n                    msg.setpoint = hvACSetPointWinterManual;\n                    msg.case = 3.1\n                };\n            break;\n            \n            default:\n                msg.command = \"default\";\n        };\n        break;\n    case 2:\n        msg.topic = \"Estate\"\n        break;\n    default:\n        msg.topic = \"default\";\n        break;\n}\nmsg.setpoint = hvACSetPointWinterAuto;\nmsg.tempCurrent = tempCurrentInt;\nnode.status({ fill: \"red\", shape: \"dot\", text: \"controllo: \" + controllo1}); \nreturn  msg ;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 340,
        "wires": [
            [
                "fb022001fd4b54bf",
                "e55f1a8a3e4f2868",
                "8915839519e16fe5",
                "30e6f05189d8c5ed",
                "b4d9a216aa3d7c0c",
                "8604149e31722a59",
                "8e030a3d97ca22e9"
            ]
        ]
    },
    {
        "id": "1064ce24171bfccb",
        "type": "inject",
        "z": "668d0f6536d63ae6",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "5",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 90,
        "y": 420,
        "wires": [
            [
                "6b396cb3302a90cd"
            ]
        ]
    },
    {
        "id": "e916a0ad779b17dd",
        "type": "link out",
        "z": "668d0f6536d63ae6",
        "name": "setSettings",
        "links": [],
        "x": 855,
        "y": 220,
        "wires": []
    },
    {
        "id": "6b396cb3302a90cd",
        "type": "moment",
        "z": "668d0f6536d63ae6",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "Europe/Rome",
        "adjAmount": "1",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "Europe/Rome",
        "x": 210,
        "y": 420,
        "wires": [
            [
                "601a1c1a170f59e4"
            ]
        ]
    },
    {
        "id": "dfca509cca15fdef",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Studio",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1260,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "0d0d5b74119e28e3",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Soggiorno",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1270,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "0b76fdf04d9a687b",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Letto",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1260,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "6ec1c5d9e8a5738a",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_Power_Cameretta",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1270,
        "y": 320,
        "wires": [
            []
        ]
    },
    {
        "id": "8604149e31722a59",
        "type": "function",
        "z": "668d0f6536d63ae6",
        "name": "",
        "func": "let msg1={} //Comando ON/OFF Soggiorno\nlet msg2={} // Comando ON/OFF Letto\nlet msg3={} //Comando ON/OFF Cameretta\nlet msg4={} //Comando ON/OFF Studio\nlet msg5={} // SetPoint\nlet now = new Date(msg.time); //Data attuale\nlet now1 = now.getHours() -1; //Estrazione ORA attuale dalla data\nlet controllo\nif (controllo===undefined) {controllo=0};\n\nmsg1.payload = msg.command;\nmsg2.payload = msg.command;\nmsg3.payload = msg.command;\nmsg4.payload = msg.command;\n\nmsg5.payload = msg.setpoint +1 //Legge il setpoint da impostare e aggiunge un grado\n\nif (msg.command == \"ON\") {\n    if ((now1 >= 5) && (now1 <= 8) && (controllo === 0)) { //Tra le 5 e le 8\n        controllo = 1\n        node.status({ fill: \"red\", shape: \"dot\", text: \"Ora \" + now1 + \" CM: \" + msg.command + \" SP: \" + msg5.payload + \" contr:\" + controllo});\n        return [msg1, null, null, null, msg5] //Accende solo Soggiorno perchè è mattina\n    }\n    else \n    if (controllo === 0) {\n        controllo = 1;\n        node.status({ fill: \"red\", shape: \"dot\", text: \"Ora \" + now1 + \" CM: \" + msg.command + \" SP: \" + msg5.payload + \" contr:\" + controllo});\n        return [msg1, msg2, msg3, msg3, msg5] //Accende tutto e invia setpoint\n    }\n}\nelse {\n    if ((now1 > 23) && (controllo == 1)) { //Se dopo le 23\n        controllo = 0\n        node.status({ fill: \"red\", shape: \"dot\", text: \"Ora \" + now1 + \" CM: \" + msg.command + \" SP: \" + msg5.payload + \" contr:\" + controllo});\n        return [msg1, msg2, msg3, msg3]; //Spegne tutto\n    }\n}\n",
        "outputs": 5,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 720,
        "y": 420,
        "wires": [
            [
                "5cbb37be8fb35691"
            ],
            [
                "527d59764384fe79"
            ],
            [],
            [],
            [
                "379535b352f5849d",
                "cba60262cd365c01",
                "3aa10a64c84b56a6",
                "12236754572d1ea3",
                "f7c6b3d39a3df31a"
            ]
        ]
    },
    {
        "id": "cba60262cd365c01",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Cameretta",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1280,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "3aa10a64c84b56a6",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Letto",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1260,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "12236754572d1ea3",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Soggiorno",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1280,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "f7c6b3d39a3df31a",
        "type": "openhab2-out2",
        "z": "668d0f6536d63ae6",
        "name": "",
        "controller": "eb6d7470c0839f99",
        "itemname": "DaikinACUnit_SetPoint_Studio",
        "topic": "ItemCommand",
        "payload": "",
        "onlywhenchanged": false,
        "x": 1270,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "88ca3705e0ad83e1",
        "type": "debug",
        "z": "668d0f6536d63ae6",
        "name": "debug 11",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1260,
        "y": 660,
        "wires": []
    },
    {
        "id": "8e030a3d97ca22e9",
        "type": "debug",
        "z": "668d0f6536d63ae6",
        "name": "debug 12",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 340,
        "wires": []
    },
    {
        "id": "caf44ecb7aea6630",
        "type": "switch",
        "z": "668d0f6536d63ae6",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 650,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "5cbb37be8fb35691",
        "type": "debug",
        "z": "668d0f6536d63ae6",
        "name": "debug 15",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 360,
        "wires": []
    },
    {
        "id": "527d59764384fe79",
        "type": "debug",
        "z": "668d0f6536d63ae6",
        "name": "debug 16",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 420,
        "wires": []
    },
    {
        "id": "379535b352f5849d",
        "type": "debug",
        "z": "668d0f6536d63ae6",
        "name": "debug 17",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 900,
        "y": 520,
        "wires": []
    },
    {
        "id": "601a1c1a170f59e4",
        "type": "function",
        "z": "668d0f6536d63ae6",
        "name": "",
        "func": "let now = new Date(msg.time);\nglobal.set(\"time\", now);\nlet hvACMode = global.get(\"hvacMode\"); // 1=Inverno, 2=Estate\nlet hvACWinterMode = global.get(\"hvacWinterMode\"); //HVAC Modo condizionamento Invernale 1=AUTO, 2=DIS, 3=MAN\nlet hvACSetPointWinterAuto; // SetPoint Winter Auto\nlet hvACSetPointWinterManual = global.get(\"setPointHvacManual\"); //SetPoint Invernale Manuale\nlet tempCurrent = global.get(\"tempCurrent\");\nlet tempCurrentInt = parseInt(tempCurrent)\nlet hvACWinterTiming = context.global.hvacWinterTiming\nlet hvACModeInt = parseInt(hvACMode);\nlet hvACWinterModeInt = parseInt(hvACWinterMode);\nlet statoAntifurto=global.get(\"statoAntifurto\");\nlet controllo1\nif (controllo1===undefined) {controllo1=\"false\"};\n\n//Lettura setpoint in base alla data/ora\nhvACSetPointWinterAuto = hvACWinterTiming[(now.getDay() * 24) + now.getHours() - 1];\nglobal.set(\"hvACSetPointWinterAuto\", hvACSetPointWinterAuto);\n\nif (hvACModeInt == 1) { //Verifica in quale stagione siamo --> Inverno\n        msg.topic = \"Inverno\"\n       // node.status({ fill: \"red\", shape: \"dot\", text: \"hvACModeInt \" + hvACModeInt +   \" tempCurrent \" + tempCurrentInt + \" hvACSetPointWinterAuto \" + hvACSetPointWinterAuto});\n        if (hvACWinterModeInt == 1) { //Verifica della modalità impostata --> AUTO\n            //auto\n               //  msg.hvACWinterModeInt = \"AUTO\"\n            if (tempCurrentInt < hvACSetPointWinterAuto && statoAntifurto == \"DISINSERITO\" && controllo1 ==  \"false\") { \n                    msg.command = \"ON\"; //Se la temperature corrente è minore di quella impostata accende\n                    controllo1 = \"true\";\n                    msg.case = 1.1;\n                    msg.controllo1 = controllo1;\n                //    node.status({ fill: \"red\", shape: \"dot\", text: \"controllo: \" + controllo});\n                }\n            else if (controllo1 == \"true\") { \n                    msg.command = \"OFF\";\n                    controllo1 = \"false\";\n                    msg.case = 1.2;\n                 //   node.status({ fill: \"red\", shape: \"dot\", text: \"controllo: \" + controllo}); \n                }\n        }\n        else if (hvACWinterModeInt == 2) {                 // Verifica della modalità impostata --> disattivo\n               // msg.hvACWinterModeInt = \"DISATTIVO\"\n                msg.command = \"OFF\";\n                controllo1 = \"false\"\n                msg.case = 2.1\n            }\n        else if (hvACWinterModeInt == 3) {           //Verifica della modalità impostata -->manuale\n               // msg.hvACWinterModeInt = \"MANUALE\"\n                if ((tempCurrentInt < hvACSetPointWinterAuto) && (statoAntifurto == \"DISINSERITO\") && (controllo1 == \"false\")) {\n               //     msg.command = \"ON\";\n                    controllo1 = \"true\";\n                    msg.setpoint = hvACSetPointWinterManual;\n                    msg.case = 3.1\n                }\n        }\n}\nelse if (hvACModeInt == 2)\n        msg.topic = \"Estate\"\n\nmsg.setpoint = hvACSetPointWinterAuto;\nmsg.tempCurrent = tempCurrentInt;\nnode.status({ fill: \"red\", shape: \"dot\", text: \"controllo: \" + controllo1}); \nreturn  msg ;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 340,
        "y": 500,
        "wires": [
            [
                "8e030a3d97ca22e9"
            ]
        ]
    },
    {
        "id": "9a2a7615.455c48",
        "type": "ui_template",
        "z": "0d5c9d22077c08ed",
        "group": "9b8f575a.b741a8",
        "name": "css etc",
        "order": 4,
        "width": "0",
        "height": "0",
        "format": "<style>\n\n.filled { height: 48px !important;padding: 0 !important; margin: 0 !important;}\n.nr-dashboard-template { padding: 0; margin: 0;}\n.rounded { border-radius: 12px 12px 12px 12px;}\n.bigfont { font-size: 18px;}\n.smallfont { font-size: 12px;}\n.thedays { cursor:pointer; vertical-align:bottom; height:48px; }\n.the2px  { background-color: #9E9E9E; height:2px; }\n.theblocks {width:100%; height:0%; background-color:#4CAF50; }\n.greybuttons { background-color:#009688 !important; width:48px; border: none;}\n.thetemps { cursor:pointer; font-size:70%; color:#9E9E9E !important; }\n.smallheadings { color:white; font-size:80%; }\n\n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>",
        "storeOutMessages": false,
        "fwdInMessages": true,
        "x": 320,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "dfd41566.f73768",
        "type": "ui_template",
        "z": "0d5c9d22077c08ed",
        "group": "9b8f575a.b741a8",
        "name": "Settings page",
        "order": 3,
        "width": "6",
        "height": "6",
        "format": "<script>\nvar thedays=[\"DOMENICA\",\"LUNEDI\",\"MARTEDI\",\"MERCOLEDI\",\"GIOVEDI\",\"VENERDI\",\"SABATO\"];\nvar ID = \"AA\";\n\nvar last=29;\n\nfunction bar(mm,val)\n{\nif (val==14) { $(mm).height(\"12%\"); $(mm).css('background-color', '#1E88E5'); } //blue\nif (val==15) { $(mm).height(\"16%\"); $(mm).css('background-color', '#039BE5'); }\nif (val==16) { $(mm).height(\"20%\"); $(mm).css('background-color', '#00ACC1'); } \nif (val==17) { $(mm).height(\"24%\"); $(mm).css('background-color', '#039BE5'); } // cyan\nif (val==18) { $(mm).height(\"28%\"); $(mm).css('background-color', '#00ACC1'); }\nif (val==19) { $(mm).height(\"32%\"); $(mm).css('background-color', '#00897B'); } \nif (val==20) { $(mm).height(\"36%\"); $(mm).css('background-color', '#388E3C'); } // green\nif (val==21) { $(mm).height(\"40%\"); $(mm).css('background-color', '#689F38'); }\nif (val==22) { $(mm).height(\"44%\"); $(mm).css('background-color', '#C0CA33'); }\nif (val==23) { $(mm).height(\"48%\"); $(mm).css('background-color', '#FDD835'); } // yellow\nif (val==24) { $(mm).height(\"52%\"); $(mm).css('background-color', '#FBC02D'); }\nif (val==25) { $(mm).height(\"56%\"); $(mm).css('background-color', '#FFA000'); }\nif (val==26) { $(mm).height(\"60%\"); $(mm).css('background-color','#E64A19'); } // red\n    \n}\n\nfunction stat(text)\n{\n$(\"#info\"+ID).text(text);\nvar tm=setTimeout(function(){ $(\"#info\"+ID).text(\"Ok\"); clearTimeout(tm);}, 3000);\n}\n\nfunction selec(val,sta)\n{\nvar w=\"#td\"+val+ID;\n if (sta) $(w).css('background-color','#4CAF50'); else $(w).css('background-color','#FFC107');\n}\n\n    (function(scope){\n        scope.ID = ID;\n        scope.send({payload: '29'})\n        scope.$watch('msg', function(msg) {\n            selec(last,0); last=msg.selector; selec(last,1);\n            for (var x=0; x<24; x++) \n                { \n                    var w=\"#t\"+x+ID; bar(w,msg.timing[((msg.days-1)*24)+x]); \n                    var v=\"#v\"+x+ID; $(v).text(msg.timing[((msg.days-1)*24)+x]+\"°\")\n                } \n            for (var x=0; x<2; x++) { var w=\"#s\"+x+ID; $(w).text(msg.timing[168+x]); }\n             $(\"#d0\"+ID).text(thedays[msg.days-1]);\n             if ((last>4) &&(last<29))\n                 $(\"#current\"+ID).text(msg.timing[((msg.days-1)*24)+last-5] + \"°\");\n             else\n                 $(\"#current\"+ID).text(\"-\");\n                 \n            if (msg.foryou!=\"\") { stat(msg.foryou);  }\n            \n             \n        });\n \n    })(scope);\n      \n\n</script>\n<table width=\"100%\">\n    \n    <tr>\n        <td colspan=24><center><span class=\"smallheadings\" >Giorno</span></center></td>\n        <!--<td colspan=3><center><span class=\"smallheadings\">Clima</span></center></td>\n        <td colspan=3><center><span class=\"smallheadings\">Fuori casa</span></center></td>-->\n    </tr>\n   \n    <tr>\n        <td ng-click=\"send({payload: '29'})\" colspan=24><center><span id=\"{{ 'd0' + ID }}\" style=\"cursor:pointer;color:white;font-size:120%\">LUNEDI</span></center></td>\n        <!--<td ng-click=\"send({payload: '1'})\" colspan=3><center><span id=\"s0\" style=\"color:white;font-size:120%\">14</span></center></td>\n        <td ng-click=\"send({payload: '2'})\" colspan=3><center><span id=\"s1\" style=\"color:white;font-size:120%\">20</span></center></td>-->\n    </tr>\n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td29' + ID }}\" colspan=24 style=\"background-color:#9E9E9E;height:2px;\"></td>        \n       <!-- <td id=\"td1\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>\n        <td id=\"td2\" colspan=3 style=\"background-color:#9E9E9E;height:2px;\"></td>-->\n    </tr>  \n\n    <tr>\n        <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"{{ 'v0' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't0' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"{{ 'v1' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't1' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"{{ 'v2' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't2' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"{{ 'v3' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't3' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"{{ 'v4' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't4' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"{{ 'v5' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't5' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"{{ 'v6' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't6' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"{{ 'v7' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't7' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"{{ 'v8' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't8' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"{{ 'v9' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't9' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"{{ 'v10' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't10' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"{{ 'v11' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't11' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td5' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td6' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td7' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td8' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td9' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td10' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td11' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td12' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td13' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td14' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td15' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td16' + ID }}\" class=\"the2px\"></td>\n    </tr>   \n    \n    <tr>\n        <td align=\"center\">0</td>\n        <td align=\"center\">1</td>\n        <td align=\"center\">2</td>\n        <td align=\"center\">3</td>\n        <td align=\"center\">4</td>\n        <td align=\"center\">5</td>\n        <td align=\"center\">6</td>\n        <td align=\"center\">7</td>\n        <td align=\"center\">8</td>\n        <td align=\"center\">9</td>\n        <td align=\"center\">10</td>\n        <td align=\"center\">11</td>\n    </tr> \n    \n    <tr>\n        <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"{{ 'v12' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't12' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"{{ 'v13' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't13' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"{{ 'v14' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't14' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"{{ 'v15' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't15' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"{{ 'v16' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't16' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"{{ 'v17' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't17' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"{{ 'v18' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't18' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"{{ 'v19' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't19' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"{{ 'v20' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't20' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"{{ 'v21' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't21' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"{{ 'v22' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't22' + ID }}\" class=\"theblocks\"></div></td>\n        <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"{{ 'v23' + ID }}\" class=\"thetemps\"></span><div id=\"{{ 't23' + ID }}\" class=\"theblocks\"></div></td>\n    </tr>  \n    \n    <tr style=\"height:2px\">\n        <td id=\"{{ 'td17' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td18' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td19' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td20' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td21' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td22' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td23' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td24' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td25' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td26' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td27' + ID }}\" class=\"the2px\"></td>\n        <td id=\"{{ 'td28' + ID }}\" class=\"the2px\"></td>\n    </tr>  \n    \n    <tr>\n        <td align=\"center\">12</td>\n        <td align=\"center\">13</td>\n        <td align=\"center\">14</td>\n        <td align=\"center\">15</td>\n        <td align=\"center\">16</td>\n        <td align=\"center\">17</td>\n        <td align=\"center\">18</td>\n        <td align=\"center\">19</td>\n        <td align=\"center\">20</td>\n        <td align=\"center\">21</td>\n        <td align=\"center\">22</td>\n        <td align=\"center\">23</td>\n    </tr> \n    \n    <tr height=\"20px\">\n        <td colspan=2 class=\"smallheadings\">Azioni:</td>\n\n        <td colspan=10 ><center><span id=\"{{ 'info' + ID }}\" class=\"smallheadings\" ></span></center></td>\n\n    </tr>\n    \n    <tr height=\"10px\">\n        <td colspan=\"12\"></td>\n    </tr>\n\n    <tr style=\"height:48px\">\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_down\">\n                    <md-tooltip md-direction=\"bottom\">DECREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        \n        <td colspan=2><center><span id=\"{{ 'current' + ID }}\" style=\"color:white;font-size:120%\">-</span></center></td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"keyboard_arrow_up\">\n                    <md-tooltip md-direction=\"bottom\">INCREMENTA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\"> \n               <ng-md-icon style=\"color: #fff;\" icon=\"content_copy\">\n                    <md-tooltip md-direction=\"bottom\">COPIA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"save\">\n                    <md-tooltip md-direction=\"bottom\">SALVA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n\n        <td colspan=2>\n            <button class=\"vibrate filled touched smallfont rounded greybuttons\"  ng-click=\"send({payload: 'c'})\"> \n                 <ng-md-icon style=\"color: #fff;\" icon=\"cancel\">\n                    <md-tooltip md-direction=\"bottom\">ANNULLA</md-tooltip>\n                </ng-md-icon>\n            </button> \n        </td>\n        <td colspan=1></td>\n    </tr>\n\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 340,
        "y": 137,
        "wires": [
            [
                "97430b63.1f4c88"
            ]
        ]
    },
    {
        "id": "97430b63.1f4c88",
        "type": "function",
        "z": "0d5c9d22077c08ed",
        "name": "Process controls",
        "func": "if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=29;\nif ( typeof context.saving == 'undefined' ) context.saving=1;\nif ( typeof context.global.timing == 'undefined' ) \n    {\n        context.global.timing=[\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        6,14\n                        ];\n        context.saving=1;                    \n    }\nvar timing=global.get(\"timing\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]++; \n                    if (timing[((context.days-1)*24)+context.selector-5]>26){ timing[((context.days-1)*24)+context.selector-5]=26; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura aumentata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Temperatura clima aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Temperatura fuori casa aumentata di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) { msg.foryou=\"Giorno successivo\"; context.days++; if (context.days>7) { context.days = 1; } }\n                break;\n    case \"d\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]--; \n                    if (timing[((context.days-1)*24)+context.selector-5]<14){ timing[((context.days-1)*24)+context.selector-5]=14; msg.foryou=\"Limite raggiunto\";}\n                    else msg.foryou=\"Temperatura decrementata\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Temperatura clima diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]>12) { timing[168+(context.selector-1)]--; msg.foryou=\"Temperatura fuori casa diminuita di 1°C\"; } else msg.foryou=\"Limite raggiunto\"; }\n                if (context.selector==29) {  msg.foryou=\"Giorno precedente\";  context.days--; if (context.days < 1) { context.days = 7;  } }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         timing[((context.days-1)*24)+context.selector-4]=timing[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Temperatura copiata nello slot successivo\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing[((context.days)*24)+a]=timing[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Impostazioni copiate nel giorno successivo\";\n                        }\n                        else if(context.days==7)\n                            msg.foryou=\"Fine della settimana raggiunto!\";\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Impostazioni salvate\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Temperatura clima selezionata\"; \n               else if (msg.payload=='2') msg.foryou=\"Temperatura fuori casa selezionata\";\n               else if (msg.payload=='29') msg.foryou=\"Giorno selezionato\";\n               else  msg.foryou=\"Regolazione temperatura ore: \" + (parseInt(msg.payload)-5);\n    break;\n    case 'c' : msg.payload=\"niente\";  msg.foryou=\"Cambiamenti annullati\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 563,
        "y": 189,
        "wires": [
            [
                "387461ec.dc158e"
            ],
            [
                "ac33e6d0.c163e8"
            ],
            [
                "8f477cbb.0b78c"
            ]
        ]
    },
    {
        "id": "aeaa17cd.6a07f8",
        "type": "inject",
        "z": "0d5c9d22077c08ed",
        "name": "Once only",
        "repeat": "",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 348,
        "y": 237,
        "wires": [
            [
                "97430b63.1f4c88",
                "94321f9f.323dc"
            ]
        ]
    },
    {
        "id": "bdc4da3.12a8028",
        "type": "inject",
        "z": "0d5c9d22077c08ed",
        "name": "Every minute",
        "repeat": "60",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 321,
        "y": 358,
        "wires": [
            [
                "aaff02d9.db667"
            ]
        ]
    },
    {
        "id": "94288cf.ccce97",
        "type": "function",
        "z": "0d5c9d22077c08ed",
        "name": "Process heat",
        "func": "var timing=global.get(\"timing\");\nvar now = new Date(msg.time);\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.payload + \"°C\"});\nreturn msg;\n\n",
        "outputs": 1,
        "noerr": 0,
        "x": 647,
        "y": 358,
        "wires": [
            [
                "715747d.b57acb8"
            ]
        ]
    },
    {
        "id": "ac33e6d0.c163e8",
        "type": "file",
        "z": "0d5c9d22077c08ed",
        "name": "backup",
        "filename": "/home/pi/data/thermo_scheduler.log",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 752,
        "y": 188,
        "wires": [
            []
        ]
    },
    {
        "id": "94321f9f.323dc",
        "type": "file in",
        "z": "0d5c9d22077c08ed",
        "name": "Restore",
        "filename": "/home/pi/data/thermo_scheduler.log",
        "format": "utf8",
        "x": 541,
        "y": 267,
        "wires": [
            [
                "d9f39fdb.ade5c"
            ]
        ]
    },
    {
        "id": "d9f39fdb.ade5c",
        "type": "function",
        "z": "0d5c9d22077c08ed",
        "name": "Restore data from SD",
        "func": "context.global.timing=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 741,
        "y": 267,
        "wires": [
            [
                "720ced17.741ec4"
            ]
        ]
    },
    {
        "id": "715747d.b57acb8",
        "type": "debug",
        "z": "0d5c9d22077c08ed",
        "name": "",
        "active": true,
        "console": "false",
        "complete": "true",
        "x": 818.5,
        "y": 358,
        "wires": []
    },
    {
        "id": "db363d9e.83b29",
        "type": "inject",
        "z": "0d5c9d22077c08ed",
        "name": "",
        "repeat": "1",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 345,
        "y": 1837,
        "wires": [
            [
                "8ab4f286.9e135"
            ]
        ]
    },
    {
        "id": "1b39179f.d8dd28",
        "type": "ui_text",
        "z": "0d5c9d22077c08ed",
        "group": "f0089344.b8ed1",
        "order": 0,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "col-center",
        "x": 739,
        "y": 1837,
        "wires": []
    },
    {
        "id": "b9bfb4a3.0cea48",
        "type": "link in",
        "z": "0d5c9d22077c08ed",
        "name": "restore",
        "links": [
            "8f477cbb.0b78c"
        ],
        "x": 401.5,
        "y": 288,
        "wires": [
            [
                "94321f9f.323dc"
            ]
        ]
    },
    {
        "id": "8f477cbb.0b78c",
        "type": "link out",
        "z": "0d5c9d22077c08ed",
        "name": "restore",
        "links": [
            "b9bfb4a3.0cea48"
        ],
        "x": 714.5,
        "y": 225,
        "wires": []
    },
    {
        "id": "acc52a0d.3759b8",
        "type": "link in",
        "z": "0d5c9d22077c08ed",
        "name": "restoreSD",
        "links": [
            "720ced17.741ec4"
        ],
        "x": 401,
        "y": 189,
        "wires": [
            [
                "97430b63.1f4c88"
            ]
        ]
    },
    {
        "id": "720ced17.741ec4",
        "type": "link out",
        "z": "0d5c9d22077c08ed",
        "name": "restoreSD",
        "links": [
            "acc52a0d.3759b8"
        ],
        "x": 895,
        "y": 267,
        "wires": []
    },
    {
        "id": "387461ec.dc158e",
        "type": "link out",
        "z": "0d5c9d22077c08ed",
        "name": "setSettings",
        "links": [
            "89be7c05.e44d8"
        ],
        "x": 715.5,
        "y": 149,
        "wires": []
    },
    {
        "id": "89be7c05.e44d8",
        "type": "link in",
        "z": "0d5c9d22077c08ed",
        "name": "setSettings",
        "links": [
            "387461ec.dc158e"
        ],
        "x": 207.5,
        "y": 137,
        "wires": [
            [
                "dfd41566.f73768"
            ]
        ]
    },
    {
        "id": "cccb363c.b966b8",
        "type": "comment",
        "z": "0d5c9d22077c08ed",
        "name": "EDIT",
        "info": "Settings page:\n-thedays2\n-ID2\n-last2\n-bar2\n-stat2\n-selec2\n\nProcess controls\n-days2\n-selector2\n-saving2\n-timing2\n-temperatures2\n\nRestore data from SD\n-timing2\n\nProcess heat\n-timing2\n\nBackup/Restore File read\nchange name of the file .log",
        "x": 251.5,
        "y": 50,
        "wires": []
    },
    {
        "id": "8ab4f286.9e135",
        "type": "moment",
        "z": "0d5c9d22077c08ed",
        "name": "",
        "topic": "",
        "input": "payload",
        "inputType": "msg",
        "inTz": "UTC",
        "adjAmount": "2",
        "adjType": "hours",
        "adjDir": "add",
        "format": "lll",
        "locale": "it_IT",
        "output": "payload",
        "outputType": "msg",
        "outTz": "UTC",
        "x": 548,
        "y": 1837,
        "wires": [
            [
                "1b39179f.d8dd28"
            ]
        ]
    },
    {
        "id": "aaff02d9.db667",
        "type": "moment",
        "z": "0d5c9d22077c08ed",
        "name": "time",
        "topic": "",
        "input": "",
        "inputType": "date",
        "inTz": "UTC",
        "adjAmount": "2",
        "adjType": "hours",
        "adjDir": "add",
        "format": "",
        "locale": "it_IT",
        "output": "time",
        "outputType": "msg",
        "outTz": "UTC",
        "x": 486.5,
        "y": 358,
        "wires": [
            [
                "94288cf.ccce97"
            ]
        ]
    },
    {
        "id": "8be635ca.03e038",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "css etc",
        "order": 10,
        "width": "0",
        "height": "0",
        "format": "<style>\n\n.cellGreen \n{\nbackground-color: #ffdddd !important;\n}\n\n  .filled { \n      height: 100% !important;\n\n      padding: 0 !important;\n      margin: 0 !important;\n  }\n  .nr-dashboard-template {\n      padding: 0;\n      margin: 0;\n  }\n  \n  .rounded {\n  border-radius: 12px 12px 12px 12px;\n}\n \n   .bigfont {\n  font-size: 18px;\n}\n\n   .smallfont {\n  font-size: 12px;\n}\n \n\n  \n.zui-table {\n    border: solid 1px #DDEEEE;\n    border-collapse: collapse;\n    border-spacing: 0;\n    font: normal 10px Arial, sans-serif;\n    outline: none;\n}\n.zui-table thead th {\n    width: 100%;\n    height:50%;\n    background-color: #99bbff;\n    border: solid 1px #DDEEEE;\n    color: #336B6B;\n    padding: 7px 3px 5px 3px;\n    text-align: center;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table tbody td {\n    width: 100%;\n    height:50%;\n    border: solid 1px #333;\n    color: #333;\n    text-align: center;\n    padding: 6px 3px 9px 3px;\n    text-shadow: 1px 1px 1px #fff;\n}\n.zui-table-rounded {\n    border: none;\n}\n.zui-table-rounded thead th {\n    background-color: #77aaff;\n    border: none;\n    text-shadow: 1px 1px 1px #ccc;\n    color: #333;\n}\n.zui-table-rounded thead th:first-child {\n    border-radius: 10px 0 0 0;\n}\n.zui-table-rounded thead th:last-child {\n    border-radius: 10px 10px 0px 0px;\n}\n.zui-table-rounded tbody td {\n    border: none;\n    border-top: solid 1px #957030;\n    background-color: #aaddff;\n}\n.zui-table-rounded tbody tr:last-child td:first-child {\n    border-radius: 10px 10px 0 0;\n}\n.zui-table-rounded tbody tr:last-child td:last-child {\n    border-radius: 0 0 10px 10px;\n}  \n</style>\n\n<script>\nvar current=1;\n\n$('.vibrate').on('click', function() {\n  navigator.vibrate(100);\n});\n\nfunction restore_bg(x) {\n            $(this).css(\"background-color\", x);\n    };\n\n$('.touched').on('mousedown', function() {\n    \n    var x= $(this).css(\"background-color\");\n    $(this).css(\"background-color\", \"yellow\");\n    \n    setTimeout(restore_bg.bind(this,x),50);\n    navigator.vibrate(80);\n    });\n    \n</script>",
        "storeOutMessages": true,
        "fwdInMessages": true,
        "x": 660,
        "y": 160,
        "wires": [
            []
        ]
    },
    {
        "id": "8815a1ed.fca9b",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "Settings page",
        "order": 2,
        "width": "6",
        "height": "6",
        "format": "<style>\n.thedays { vertical-align:bottom; height:48px; }\n.the2px  { background-color:black; height:2px; }\n.theblocks {width:100%; height:0%; background-color:green; }\n.greybuttons { background-color:#dddddd !important; width:48px; }\n.thetemps { font-size:70%; color:#888888 !important; }\n.smallheadings { color:black; font-size:80%; }\n\n</style>\n\n<script>\nvar thedays = [\"SUNDAY\", \"MONDAY\", \"TUESDAY\", \"WEDNESDAY\", \"THURSDAY\", \"FRIDAY\", \"SATURDAY\"];\n\nvar last = 1;\n\nfunction bar(mm, val) {\n  if (val == 14) {\n    $(mm).height(\"12%\");\n    $(mm).css('background-color', '#6666ff');\n  } //blue\n  if (val == 15) {\n    $(mm).height(\"16%\");\n    $(mm).css('background-color', '#5577ff');\n  }\n  if (val == 16) {\n    $(mm).height(\"20%\");\n    $(mm).css('background-color', '#5599ff');\n  }\n  if (val == 17) {\n    $(mm).height(\"24%\");\n    $(mm).css('background-color', '#55ccdd');\n  } // cyan\n  if (val == 18) {\n    $(mm).height(\"28%\");\n    $(mm).css('background-color', '#55ddaa');\n  }\n  if (val == 19) {\n    $(mm).height(\"32%\");\n    $(mm).css('background-color', '#55dd55');\n  }\n  if (val == 20) {\n    $(mm).height(\"36%\");\n    $(mm).css('background-color', '#55dd55');\n  } // green\n  if (val == 21) {\n    $(mm).height(\"40%\");\n    $(mm).css('background-color', '#55dd55');\n  }\n  if (val == 22) {\n    $(mm).height(\"44%\");\n    $(mm).css('background-color', '#aadd55');\n  }\n  if (val == 23) {\n    $(mm).height(\"48%\");\n    $(mm).css('background-color', '#dddd55');\n  } // yellow\n  if (val == 24) {\n    $(mm).height(\"52%\");\n    $(mm).css('background-color', '#ffaa55');\n  }\n  if (val == 25) {\n    $(mm).height(\"56%\");\n    $(mm).css('background-color', '#ff8855');\n  }\n  if (val == 26) {\n    $(mm).height(\"60%\");\n    $(mm).css('background-color', '#ff7777');\n  } // red\n\n}\n\nfunction stat(text) {\n  $(\"#info\").text(text);\n  var tm = setTimeout(function() {\n    $(\"#info\").text(\"Ok\");\n    clearTimeout(tm);\n  }, 3000);\n}\n\nfunction selec(val, sta) {\n  var w = \"#td\" + val;\n  if (sta) $(w).css('background-color', 'magenta');\n  else $(w).css('background-color', 'black');\n}\n\n(function(scope) {\n  scope.$watch('msg', function(msg) {\n    selec(last, 0);\n    last = msg.selector;\n    selec(last, 1);\n    for (var x = 0; x < 24; x++) {\n      var w = \"#t\" + x;\n      bar(w, msg.timing[((msg.days - 1) * 24) + x]);\n      var v = \"#v\" + x;\n      $(v).text(msg.timing[((msg.days - 1) * 24) + x] + \"C\")\n    }\n    for (var x = 0; x < 2; x++) {\n      var w = \"#s\" + x;\n      $(w).text(msg.timing[168 + x] + \"C\");\n    }\n    $(\"#d0\").text(thedays[msg.days - 1]);\n    if ((last > 4) && (last < 29))\n      $(\"#current\").text(msg.timing[((msg.days - 1) * 24) + last - 5] + \"C\");\n    else\n      $(\"#current\").text(\"-\");\n\n    if (msg.foryou != \"\") {\n      stat(msg.foryou);\n    }\n\n\n  });\n\n})(scope);\n\n</script>\n<table width=\"100%\">\n  <tr style=\"height:2px\">\n    <td colspan=12 style=\"background-color:black;height:5px;\"></td>\n  </tr>\n\n  <tr>\n    <td colspan=6>\n      <center><span class=\"smallheadings\">Day</span></center>\n    </td>\n    <td colspan=3>\n      <center><span class=\"smallheadings\">Frost</span></center>\n    </td>\n    <td colspan=3>\n      <center><span class=\"smallheadings\">Away</span></center>\n    </td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '29'})\" colspan=6>\n      <center><span id=\"d0\" style=\"color:blue;font-size:120%\">MONDAY</span></center>\n    </td>\n    <td ng-click=\"send({payload: '1'})\" colspan=3>\n      <center><span id=\"s0\" style=\"color:blue;font-size:120%\">14</span></center>\n    </td>\n    <td ng-click=\"send({payload: '2'})\" colspan=3>\n      <center><span id=\"s1\" style=\"color:blue;font-size:120%\">20</span></center>\n    </td>\n  </tr>\n\n  <tr style=\"height:2px\">\n    <td id=\"td29\" colspan=6 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"td1\" colspan=3 style=\"background-color:black;height:2px;\"></td>\n    <td id=\"td2\" colspan=3 style=\"background-color:black;height:2px;\"></td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '5'})\" class=\"thedays\"><span id=\"v0\" class=\"thetemps\"></span>\n      <div id=\"t0\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '6'})\" class=\"thedays\"><span id=\"v1\" class=\"thetemps\"></span>\n      <div id=\"t1\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '7'})\" class=\"thedays\"><span id=\"v2\" class=\"thetemps\"></span>\n      <div id=\"t2\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '8'})\" class=\"thedays\"><span id=\"v3\" class=\"thetemps\"></span>\n      <div id=\"t3\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '9'})\" class=\"thedays\"><span id=\"v4\" class=\"thetemps\"></span>\n      <div id=\"t4\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '10'})\" class=\"thedays\"><span id=\"v5\" class=\"thetemps\"></span>\n      <div id=\"t5\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '11'})\" class=\"thedays\"><span id=\"v6\" class=\"thetemps\"></span>\n      <div id=\"t6\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '12'})\" class=\"thedays\"><span id=\"v7\" class=\"thetemps\"></span>\n      <div id=\"t7\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '13'})\" class=\"thedays\"><span id=\"v8\" class=\"thetemps\"></span>\n      <div id=\"t8\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '14'})\" class=\"thedays\"><span id=\"v9\" class=\"thetemps\"></span>\n      <div id=\"t9\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '15'})\" class=\"thedays\"><span id=\"v10\" class=\"thetemps\"></span>\n      <div id=\"t10\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '16'})\" class=\"thedays\"><span id=\"v11\" class=\"thetemps\"></span>\n      <div id=\"t11\" class=\"theblocks\"></div>\n    </td>\n  </tr>\n\n  <tr style=\"height:2px\">\n    <td id=\"td5\" class=\"the2px\"></td>\n    <td id=\"td6\" class=\"the2px\"></td>\n    <td id=\"td7\" class=\"the2px\"></td>\n    <td id=\"td8\" class=\"the2px\"></td>\n    <td id=\"td9\" class=\"the2px\"></td>\n    <td id=\"td10\" class=\"the2px\"></td>\n    <td id=\"td11\" class=\"the2px\"></td>\n    <td id=\"td12\" class=\"the2px\"></td>\n    <td id=\"td13\" class=\"the2px\"></td>\n    <td id=\"td14\" class=\"the2px\"></td>\n    <td id=\"td15\" class=\"the2px\"></td>\n    <td id=\"td16\" class=\"the2px\"></td>\n  </tr>\n\n  <tr>\n    <td>0</td>\n    <td>1</td>\n    <td>2</td>\n    <td>3</td>\n    <td>4</td>\n    <td>5</td>\n    <td>6</td>\n    <td>7</td>\n    <td>8</td>\n    <td>9</td>\n    <td>10</td>\n    <td>11</td>\n  </tr>\n\n  <tr>\n    <td ng-click=\"send({payload: '17'})\" class=\"thedays\"><span id=\"v12\" class=\"thetemps\"></span>\n      <div id=\"t12\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '18'})\" class=\"thedays\"><span id=\"v13\" class=\"thetemps\"></span>\n      <div id=\"t13\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '19'})\" class=\"thedays\"><span id=\"v14\" class=\"thetemps\"></span>\n      <div id=\"t14\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '20'})\" class=\"thedays\"><span id=\"v15\" class=\"thetemps\"></span>\n      <div id=\"t15\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '21'})\" class=\"thedays\"><span id=\"v16\" class=\"thetemps\"></span>\n      <div id=\"t16\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '22'})\" class=\"thedays\"><span id=\"v17\" class=\"thetemps\"></span>\n      <div id=\"t17\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '23'})\" class=\"thedays\"><span id=\"v18\" class=\"thetemps\"></span>\n      <div id=\"t18\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '24'})\" class=\"thedays\"><span id=\"v19\" class=\"thetemps\"></span>\n      <div id=\"t19\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '25'})\" class=\"thedays\"><span id=\"v20\" class=\"thetemps\"></span>\n      <div id=\"t20\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '26'})\" class=\"thedays\"><span id=\"v21\" class=\"thetemps\"></span>\n      <div id=\"t21\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '27'})\" class=\"thedays\"><span id=\"v22\" class=\"thetemps\"></span>\n      <div id=\"t22\" class=\"theblocks\"></div>\n    </td>\n    <td ng-click=\"send({payload: '28'})\" class=\"thedays\"><span id=\"v23\" class=\"thetemps\"></span>\n      <div id=\"t23\" class=\"theblocks\"></div>\n    </td>\n  </tr>\n\n  <tr style=\"height:2px\">\n    <td id=\"td17\" class=\"the2px\"></td>\n    <td id=\"td18\" class=\"the2px\"></td>\n    <td id=\"td19\" class=\"the2px\"></td>\n    <td id=\"td20\" class=\"the2px\"></td>\n    <td id=\"td21\" class=\"the2px\"></td>\n    <td id=\"td22\" class=\"the2px\"></td>\n    <td id=\"td23\" class=\"the2px\"></td>\n    <td id=\"td24\" class=\"the2px\"></td>\n    <td id=\"td25\" class=\"the2px\"></td>\n    <td id=\"td26\" class=\"the2px\"></td>\n    <td id=\"td27\" class=\"the2px\"></td>\n    <td id=\"td28\" class=\"the2px\"></td>\n  </tr>\n\n  <tr>\n    <td>12</td>\n    <td>13</td>\n    <td>14</td>\n    <td>15</td>\n    <td>16</td>\n    <td>17</td>\n    <td>18</td>\n    <td>19</td>\n    <td>20</td>\n    <td>21</td>\n    <td>22</td>\n    <td>23</td>\n  </tr>\n\n  <tr height=\"20px\">\n    <td colspan=2 bgcolor=\"#dddddd\"><span class=\"smallheadings\">&nbsp;Status:</span></td>\n\n    <td colspan=10 bgcolor=\"#dddddd\">\n      <center><span id=\"info\" class=\"smallheadings\">OK</span></center>\n    </td>\n  </tr>\n\n  <tr height=\"10px\">\n    <td colspan=\"12\"></td>\n  </tr>\n\n  <tr style=\"height:48px\">\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-left-double-2.png':'/myicons/png/48x48/actions/arrow-left-double-2.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <center><span id=\"current\" style=\"color:black;font-size:120%\">-</span></center>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-right-double-2.png':'/myicons/png/48x48/actions/arrow-right-double-2.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'r'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/edit-copy-4.png':'/myicons/png/48x48/actions/edit-copy-4.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 's'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/document-save-5.png':'/myicons/png/48x48/actions/document-save-5.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n\n    <td colspan=2>\n      <md-button class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'c'})\">\n        <img style=\"outline : none;\" ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/dialog-cancel-5.png':'/myicons/png/48x48/actions/dialog-cancel-5.png'}}\" height=\"36px\" />\n      </md-button>\n    </td>\n    <td colspan=1></td>\n  </tr>\n\n</table>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 840,
        "y": 160,
        "wires": [
            [
                "aba7c9ce.0b6c28"
            ]
        ]
    },
    {
        "id": "aba7c9ce.0b6c28",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Process controls",
        "func": "if ( typeof context.days == 'undefined' ) context.days=1;\nif ( typeof context.selector == 'undefined' ) context.selector=1;\nif ( typeof context.saving == 'undefined' ) context.saving=0;\nif ( typeof context.global.incomingTemperature == 'undefined' ) context.global.incomingTemperature=0;\nif ( typeof context.global.incomingHumidity == 'undefined' ) context.global.incomingHumidity=0;\nif ( typeof context.global.hold == 'undefined' ) context.global.hold=0;\nif ( typeof context.global.away == 'undefined' ) context.global.away=0;\nif ( typeof context.global.manual == 'undefined' ) context.global.manual=0;\nif ( typeof context.global.setTemperature == 'undefined' ) context.global.setTemperature=0;\nif ( typeof context.global.manualTimer == 'undefined' ) context.global.manualTimer=0;\nif ( typeof context.global.timing == 'undefined' ) \n    {\n        context.global.timing=[\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,\n                        8,14\n                        ];\n        context.saving=0;  \n        msg.payload=\"anything\";  msg.foryou=\"Restoring\"; return([null,null,msg]);\n    }\nvar timing=global.get(\"timing\");\n\nswitch (msg.payload)\n    {\n    case \"u\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]++; \n                    if (timing[((context.days-1)*24)+context.selector-5]>26) timing[((context.days-1)*24)+context.selector-5]=26;\n                    msg.foryou=\"Incremented temperature\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Incremented frost setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]<26) {  timing[168+(context.selector-1)]++; msg.foryou=\"Incremented away setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==29) { if (context.days<7) { context.days++; msg.foryou=\"Forward one day\";} else msg.foryou=\"End of days!!\"; }\n                break;\n    case \"d\" :  if ((context.selector>4)&&(context.selector<29))\n                {\n                    timing[((context.days-1)*24)+context.selector-5]--; \n                    if (timing[((context.days-1)*24)+context.selector-5]<14) timing[((context.days-1)*24)+context.selector-5]=14;\n                    msg.foryou=\"Decremented temperature\";\n                }\n                if (context.selector==1) { if (timing[168+(context.selector-1)]>8) { timing[168+(context.selector-1)]--; msg.foryou=\"Decremented frost setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==2) { if (timing[168+(context.selector-1)]>8) { timing[168+(context.selector-1)]--; msg.foryou=\"Decremented away setting 1 degree\"; } else msg.foryou=\"Hit limit\"; }\n                if (context.selector==29) { if (context.days>1) { context.days--;  msg.foryou=\"Backward one day\";} else msg.foryou=\"Beginning of days!!\";  }\n                break;\n    case 'r' :  if ((context.selector>=5)&&(context.selector<28))\n                        {\n                         timing[((context.days-1)*24)+context.selector-4]=timing[((context.days-1)*24)+context.selector-5];   \n                         context.selector++;\n                         msg.foryou=\"Copied settings to the next hour slot\";\n                        }\n                if ((context.selector==29)&&(context.days<7))\n                        {\n                         for (var a=0;a<24;a++)\n                            {\n                             timing[((context.days)*24)+a]=timing[((context.days-1)*24)+a];   \n                            }\n                         context.days++;\n                         msg.foryou=\"Copied a complete day's settings\";\n                        }\n                break;\n    case 's': context.saving=0;  msg.foryou=\"Settings saved to disk\"; break;\n    case '1':\n    case '2':\n    case '3':\n    case '4':\n    case '5':\n    case '6':\n    case '7':\n    case '8':\n    case '9':\n    case '10':\n    case '11':\n    case '12':\n    case '13':\n    case '14':\n    case '15':\n    case '16':\n    case '17':\n    case '18':\n    case '19':\n    case '20':\n    case '21':\n    case '22':\n    case '23':\n    case '24':\n    case '25':\n    case '26':\n    case '27':\n    case '28':\n    case '29': context.selector=parseInt(msg.payload);\n               if (msg.payload=='1') msg.foryou=\"Frost temperature selection\"; \n               else if (msg.payload=='2') msg.foryou=\"Away temperature selection\";\n               else if (msg.payload=='29') msg.foryou=\"Day selection\";\n               else  msg.foryou=\"Selected hour period \" + (parseInt(msg.payload)-4);\n    break;\n    case 'c' : msg.payload=\"anything\";  msg.foryou=\"Changes cancelled\"; node.send([null,null,msg]);\n    }\n\nmsg.temperatures=context.temperatures;\nmsg.timing=timing;\nmsg.days=context.days;\nmsg.selector=context.selector;\n\nnode.send([msg,null,null]);\n\nif (context.saving===0) \n    { \n       msg.topic=\"\";\n        msg.timing=\"\";\n        msg.payload=JSON.stringify(timing);\n        node.send([null,msg,null]); \n        context.saving=1;\n    }\n    msg.foryou=\"\"",
        "outputs": "3",
        "noerr": 0,
        "x": 770,
        "y": 220,
        "wires": [
            [
                "8815a1ed.fca9b"
            ],
            [
                "9f13095d.38ba18"
            ],
            [
                "8421f1bf.f6286"
            ]
        ]
    },
    {
        "id": "945f3b38.6cc9c8",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "Once only",
        "repeat": "",
        "crontab": "",
        "once": true,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 560,
        "y": 280,
        "wires": [
            [
                "aba7c9ce.0b6c28",
                "8421f1bf.f6286"
            ]
        ]
    },
    {
        "id": "13c303be.55f94c",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "Every minute",
        "repeat": "60",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "",
        "payloadType": "str",
        "x": 560,
        "y": 340,
        "wires": [
            [
                "7f0331f4.5b289",
                "695e047b.c1ecac"
            ]
        ]
    },
    {
        "id": "7f0331f4.5b289",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Process heat",
        "func": "var timing=global.get(\"timing\");\nvar now = new Date();\nmsg.payload=timing[(now.getDay()*24)+now.getHours()];\nmsg.frost=timing[168];\nmsg.away=timing[169];\n\nmsg.temperature=global.get(\"incomingTemperature\");\nmsg.humidity=global.get(\"incomingHumidity\");\nmsg.set=msg.payload;\nif (global.get(\"manualTimer\")) global.set(\"manualTimer\",global.get(\"manualTimer\")-1);\nelse global.set(\"manual\",0);\nmsg.desired=msg.set;\nglobal.set(\"setTemperature\",msg.desired);\nmsg.desired+=global.get(\"manual\");\nif (global.get(\"frost\")) { msg.desired=global.get(\"timing\")[168]; global.set(\"frost\",global.get(\"frost\")-1); }\nif (global.get(\"away\")) { msg.desired=global.get(\"timing\")[169]; global.set(\"away\",global.get(\"away\")-1); }\nif (msg.desired>msg.temperature) msg.relay=1; else msg.relay=0;\n\nmsg.payload=global.get(\"incomingTemperature\");\n\nnode.status({fill:\"blue\",shape:\"dot\",text:\"Set point \" + msg.desired + \"c - Actual \" + msg.temperature +\"c\"});\n\nnode.send([msg,null]);\nmsg.payload=msg.relay;\nnode.send([null,msg]);\n\n\n\n\n",
        "outputs": "2",
        "noerr": 0,
        "x": 790,
        "y": 360,
        "wires": [
            [
                "66e21166.7fada",
                "7cd73a4e.8b2214"
            ],
            [
                "8152db3c.058368"
            ]
        ]
    },
    {
        "id": "9f13095d.38ba18",
        "type": "file",
        "z": "6bc3878acc4dffa6",
        "name": "backup",
        "filename": "/home/pi/petesstatlog.log",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "true",
        "x": 1000,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "8421f1bf.f6286",
        "type": "file in",
        "z": "6bc3878acc4dffa6",
        "name": "Restore",
        "filename": "/home/pi/petesstatlog.log",
        "filenameType": "str",
        "format": "utf8",
        "encoding": "none",
        "allProps": false,
        "x": 1000,
        "y": 220,
        "wires": [
            [
                "5efea5f0.dec25c"
            ]
        ]
    },
    {
        "id": "5efea5f0.dec25c",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Restore data from SD",
        "func": "context.global.timing=JSON.parse(msg.payload);\nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 780,
        "y": 300,
        "wires": [
            [
                "aba7c9ce.0b6c28"
            ]
        ]
    },
    {
        "id": "dbfea475.ca5438",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "incoming temperature 18c",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "18",
        "payloadType": "str",
        "x": 230,
        "y": 160,
        "wires": [
            [
                "5c120e63.28f36"
            ]
        ]
    },
    {
        "id": "c61fdaa7.e80b08",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "incoming temperature 20c",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "20",
        "payloadType": "str",
        "x": 230,
        "y": 200,
        "wires": [
            [
                "5c120e63.28f36"
            ]
        ]
    },
    {
        "id": "48220f38.43af9",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "incoming temperature 26c",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "26",
        "payloadType": "str",
        "x": 230,
        "y": 240,
        "wires": [
            [
                "5c120e63.28f36"
            ]
        ]
    },
    {
        "id": "994e52ef.3e505",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "incoming humidity 40%",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "40",
        "payloadType": "str",
        "x": 220,
        "y": 280,
        "wires": [
            [
                "7eebdc07.593384"
            ]
        ]
    },
    {
        "id": "12a4998b.429e26",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "incoming humidity 50%",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "50",
        "payloadType": "str",
        "x": 220,
        "y": 320,
        "wires": [
            [
                "7eebdc07.593384"
            ]
        ]
    },
    {
        "id": "5c120e63.28f36",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Store temperature",
        "func": "global.set(\"incomingTemperature\",msg.payload);",
        "outputs": "0",
        "noerr": 0,
        "x": 490,
        "y": 200,
        "wires": []
    },
    {
        "id": "7eebdc07.593384",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Store humidity",
        "func": "global.set(\"incomingHumidity\",msg.payload);",
        "outputs": "0",
        "noerr": 0,
        "x": 480,
        "y": 240,
        "wires": []
    },
    {
        "id": "af578cf3.7b3c1",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "Test \"Away\" 2 minutes",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "2",
        "payloadType": "str",
        "x": 220,
        "y": 360,
        "wires": [
            [
                "59872d80.b244e4"
            ]
        ]
    },
    {
        "id": "10996dc6.8d5d82",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "Test \"Away\" clear",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "0",
        "payloadType": "str",
        "x": 200,
        "y": 400,
        "wires": [
            [
                "59872d80.b244e4"
            ]
        ]
    },
    {
        "id": "678411fc.5d32b",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "Test \"Frost\" 2 minutes",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "2",
        "payloadType": "str",
        "x": 220,
        "y": 440,
        "wires": [
            [
                "2b79500.97c95b"
            ]
        ]
    },
    {
        "id": "ea2fdaeb.38db08",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "Test \"Frost\" clear",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "0",
        "payloadType": "str",
        "x": 200,
        "y": 480,
        "wires": [
            [
                "2b79500.97c95b"
            ]
        ]
    },
    {
        "id": "2b79500.97c95b",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Store \"Hold\"",
        "func": "global.set(\"frost\",msg.payload);",
        "outputs": "0",
        "noerr": 0,
        "x": 470,
        "y": 440,
        "wires": []
    },
    {
        "id": "59872d80.b244e4",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Store \"Away\"",
        "func": "global.set(\"away\",msg.payload);",
        "outputs": "0",
        "noerr": 0,
        "x": 470,
        "y": 400,
        "wires": []
    },
    {
        "id": "c3165cd0.aaa8b",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "sample forecast",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "Dry, 2c with chance of snow",
        "payloadType": "str",
        "x": 200,
        "y": 520,
        "wires": [
            [
                "47a3d01f.504ae"
            ]
        ]
    },
    {
        "id": "116f01b3.e45b0e",
        "type": "inject",
        "z": "6bc3878acc4dffa6",
        "name": "Sample forecast",
        "repeat": "",
        "crontab": "",
        "once": false,
        "topic": "",
        "payload": "Wet, 12c, possibly rain tonight",
        "payloadType": "str",
        "x": 200,
        "y": 560,
        "wires": [
            [
                "47a3d01f.504ae"
            ]
        ]
    },
    {
        "id": "47a3d01f.504ae",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Store forecast",
        "func": "global.set(\"forecast\",msg.payload);",
        "outputs": "0",
        "noerr": 0,
        "x": 480,
        "y": 520,
        "wires": []
    },
    {
        "id": "8152db3c.058368",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Pretend relay",
        "func": "if (msg.payload==1)\nnode.status({fill:\"red\",shape:\"dot\",text:\"Relay ON\"});\nelse\nnode.status({fill:\"black\",shape:\"dot\",text:\"Relay OFF\"});\n",
        "outputs": "0",
        "noerr": 0,
        "x": 1040,
        "y": 320,
        "wires": []
    },
    {
        "id": "3168e55f.bdf29a",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Handle SET",
        "func": "// here we set manual override controls - valid for 60 minutes after last change.\n\n\nif (global.get(\"away\")===0)\n{\n    if (msg.payload==\"u\") { global.set(\"manualTimer\",60); if (global.get(\"manual\")<12) global.set(\"manual\",global.get(\"manual\")+1); }\n    if (msg.payload==\"d\") { global.set(\"manualTimer\",60); if (global.get(\"manual\")>-12) global.set(\"manual\",global.get(\"manual\")-1); }\n    if (msg.payload==\"a\") { global.set(\"manualTimer\",0); global.set(\"manual\",0); }\n}\n\nvar x= msg.desired=global.get(\"setTemperature\") + global.get(\"manual\");\nmsg.desired=x;\n\nif (global.get(\"manual\")===0) msg.colour=\"#aaddff\"; else msg.colour=\"#aaffaa\";\n\nif (global.get(\"frost\")) { msg.desired=global.get(\"timing\")[168]; msg.colour=\"#ffbbbb\"; }\nif (global.get(\"away\"))  { msg.desired=global.get(\"timing\")[169];msg.colour=\"#ffbbbb\";  }\n\nmsg.payload=msg.desired;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 850,
        "y": 460,
        "wires": [
            [
                "7cd73a4e.8b2214",
                "66e21166.7fada"
            ]
        ]
    },
    {
        "id": "62da9d50.ffd1e4",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "up",
        "order": 4,
        "width": "1",
        "height": "1",
        "format": "  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-right-2.png':'/myicons/png/48x48/actions/arrow-right-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 650,
        "y": 420,
        "wires": [
            [
                "3168e55f.bdf29a",
                "f805393e.25dbf8"
            ]
        ]
    },
    {
        "id": "a033d106.7d68e",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "down",
        "order": 3,
        "width": "1",
        "height": "1",
        "format": "  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'd'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-down-2.png':'/myicons/png/48x48/actions/arrow-left-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 650,
        "y": 460,
        "wires": [
            [
                "3168e55f.bdf29a",
                "f805393e.25dbf8"
            ]
        ]
    },
    {
        "id": "4f31478.6f1dcb8",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Handle AWAY",
        "func": "// here we set manual override controls - valid for 60 minutes after last change.\nif (msg.payload==\"u\") {  global.set(\"away\",global.get(\"away\")+1); }\nif (msg.payload==\"uu\") { global.set(\"away\",global.get(\"away\")+24); }\nif (msg.payload==\"a\") { global.set(\"away\",0);  }\nmsg.away=global.get(\"away\");\n\nif (global.get(\"away\")===0) msg.colour=\"#aaddff\"; else msg.colour=\"#aaffaa\";\n\nvar t=parseInt(msg.away);\nif (t>23) t=((t/24).toFixed(1))+\"d\"; else t=t+\"h\";\nmsg.away=t;\n  \nmsg.payload=\"\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 860,
        "y": 540,
        "wires": [
            [
                "3168e55f.bdf29a",
                "6aee2782.4a6768"
            ]
        ]
    },
    {
        "id": "110a1fe5.53545",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "more",
        "order": 6,
        "width": "1",
        "height": "1",
        "format": "  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'u'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-right-2.png':'/myicons/png/48x48/actions/arrow-right-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 650,
        "y": 540,
        "wires": [
            [
                "4f31478.6f1dcb8",
                "f805393e.25dbf8"
            ]
        ]
    },
    {
        "id": "6a665b46.ac7374",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "mmore",
        "order": 7,
        "width": "1",
        "height": "1",
        "format": "  <md-button  class=\"vibrate filled touched smallfont rounded greybuttons\" ng-click=\"send({payload: 'uu'})\"> \n                <img style=\"outline : none;\" \n                             ng-src=\"{{(msg.payload)?'/myicons/png/48x48/actions/arrow-left-double-2.png':'/myicons/png/48x48/actions/arrow-right-double-2.png'}}\" \n                              height=\"36px\"\n                />\n</md-button> ",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 660,
        "y": 580,
        "wires": [
            [
                "4f31478.6f1dcb8",
                "f805393e.25dbf8"
            ]
        ]
    },
    {
        "id": "66e21166.7fada",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "newergauge",
        "order": 1,
        "width": "3",
        "height": "3",
        "format": "<script type=\"text/javascript\" src=\"/myjs/gauge.min.js\"></script>\n<script>\n\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n           gauge.value=msg.payload;\n           // if (msg.units!=\"\") gauge.units=msg.units;\n        });\n \n    })(scope);\nvar gauge = new RadialGauge({\n    renderTo: 'canvas-id',\n    width: 160,\n    height: 160,\n    units: \"Degrees C\",\n    title: \"Thermometer\",\n    minValue: 10,\n    maxValue: 30,\n    majorTicks: [\n        '10',\n        '15',\n        '20',\n        '25',\n        '30'\n    ],\n    minorTicks: 5,\n    strokeTicks: true,\n   highlights  : [\n        { from : 10,  to : 15, color : '#8888ff' },\n        { from : 15, to : 20, color :  '#88ff88' },\n        { from : 20, to : 25, color :  '#ffff00' },\n        { from : 25, to : 30, color :  '#ff8888' }\n    ],\n\n    colorPlate: \"#fff\",\n    borderShadowWidth: 0,\n    borders: true,\n    needleType: \"arrow\",\n    valueInt: 2,\n    valueDec:0,\n    needleWidth: 2,\n    fontTitleSize: 42,\n    needleCircleSize: 14,\n    needleCircleOuter: true,\n    needleCircleInner: false,\n    animationDuration: 500,\n    animationRule: \"linear\"\n}).draw();\n\ngauge.value = 18;\n\n</script>\n<canvas style=\"outline: none;\" ng-click=\"send({payload: ' '})\" id=\"canvas-id\">\n\n</canvas>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 1070,
        "y": 380,
        "wires": [
            [
                "7f0331f4.5b289",
                "1a90e0d1.e6e7af"
            ]
        ]
    },
    {
        "id": "7cd73a4e.8b2214",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "SET",
        "order": 5,
        "width": "1",
        "height": "1",
        "format": "<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if (msg.desired!=\"\") $(\"#infor\").text(msg.desired+\"C\");\n             if (msg.colour!=\"\") $(\"#infor\").css(\"background-color\",msg.colour);\n        });\n \n    })(scope);\n</script>\n<table  ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>SET</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr >\n            <td id=\"infor\"></td>\n        </tr>\n\n    </tbody>\n</table>\n",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 1050,
        "y": 440,
        "wires": [
            [
                "3168e55f.bdf29a",
                "f805393e.25dbf8"
            ]
        ]
    },
    {
        "id": "6aee2782.4a6768",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "AWAY",
        "order": 8,
        "width": "1",
        "height": "1",
        "format": "<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if (msg.away!=\"\") $(\"#awaytable\").text(msg.away);\n             if (msg.colour!=\"\") $(\"#awaytable\").css(\"background-color\",msg.colour);\n        });\n \n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"vibrate zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th>AWAY</th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"awaytable\"></td>\n    \n        </tr>\n\n    </tbody>\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 1050,
        "y": 500,
        "wires": [
            [
                "4f31478.6f1dcb8",
                "f805393e.25dbf8"
            ]
        ]
    },
    {
        "id": "143eebdc.ccb4c4",
        "type": "ui_template",
        "z": "6bc3878acc4dffa6",
        "group": "37f2a2e2.88cc6e",
        "name": "STATUS",
        "order": 9,
        "width": "3",
        "height": "1",
        "format": "<script>\n   (function(scope){\n        scope.$watch('msg', function(msg) {\n             if (msg.topic!=\"\") $(\"#hdr1\").text(msg.topic);\n             if (msg.payload!=\"\") $(\"#bod1\").text(msg.payload);\n        });\n    })(scope);\n</script>\n\n<table ng-click=\"send({payload: 'a'})\" width=100% height=100% class=\"zui-table zui-table-rounded\">\n    <thead>\n        <tr>\n            <th id=\"hdr1\">></th>\n        </tr>\n    </thead>\n    <tbody>\n        <tr>\n            <td id=\"bod1\"></td>\n    \n        </tr>\n\n    </tbody>\n</table>",
        "storeOutMessages": false,
        "fwdInMessages": false,
        "x": 1080,
        "y": 600,
        "wires": [
            []
        ]
    },
    {
        "id": "695e047b.c1ecac",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "show humidity",
        "func": "function theNewDate()\n{\n   var d = new Date(),\n    minutes = d.getMinutes().toString().length == 1 ? '0'+d.getMinutes() : d.getMinutes();\n    hours = d.getHours().toString().length == 1 ? '0'+d.getHours() : d.getHours();\n    ampm = d.getHours() >= 12 ? 'pm' : 'am';\n    months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];\n    days = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];\n    var m= days[d.getDay()]+' '+months[d.getMonth()]+' '+d.getDate()+' '+d.getFullYear()+' '+hours+':'+minutes+ampm;\n    return m;\n}\n\nmsg.topic=theNewDate();\nmsg.payload=\"Humidity: \" + global.get(\"incomingHumidity\") +\"%\" ;\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 900,
        "y": 600,
        "wires": [
            [
                "143eebdc.ccb4c4"
            ]
        ]
    },
    {
        "id": "f805393e.25dbf8",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Showing settings",
        "func": "msg.payload=\"Showing settings\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 910,
        "y": 640,
        "wires": [
            [
                "143eebdc.ccb4c4"
            ]
        ]
    },
    {
        "id": "1a90e0d1.e6e7af",
        "type": "function",
        "z": "6bc3878acc4dffa6",
        "name": "Showing actual",
        "func": "msg.payload=\"Showing actual\";\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "x": 900,
        "y": 680,
        "wires": [
            [
                "143eebdc.ccb4c4"
            ]
        ]
    },
    {
        "id": "e09cffe9bb0caf4d",
        "type": "function",
        "z": "7c89a60c.c53b78",
        "name": "function 5",
        "func": "// Ottieni la data e l'ora corrente\nlet currentDate = new Date();\n\n// Calcola il fuso orario di Roma\nlet offset = currentDate.getTimezoneOffset(); // Differenza UTC in minuti\nlet romeTime = new Date(currentDate.getTime() + offset * 60000 + 3600000); // CET (UTC+1)\n\n// Aggiusta per l'ora legale (CEST)\nlet isDST = romeTime.getMonth() > 2 && romeTime.getMonth() < 10 && \n            (romeTime.getMonth() > 2 || (romeTime.getMonth() === 2 && romeTime.getDate() - romeTime.getDay() >= 25)) && \n            (romeTime.getMonth() < 9 || (romeTime.getMonth() === 9 && romeTime.getDate() - romeTime.getDay() < 25));\nif (isDST) {\n    romeTime = new Date(romeTime.getTime() + 3600000); // CEST (UTC+2)\n}\n\n// Estrai solo le ore\nlet currentHour = romeTime.getHours();\n\n// Output\nmsg.payload = currentHour;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 560,
        "y": 340,
        "wires": [
            [
                "0ce546114077bd76"
            ]
        ]
    },
    {
        "id": "8dbd484fa8efe414",
        "type": "inject",
        "z": "7c89a60c.c53b78",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 320,
        "y": 340,
        "wires": [
            [
                "e09cffe9bb0caf4d"
            ]
        ]
    },
    {
        "id": "0ce546114077bd76",
        "type": "debug",
        "z": "7c89a60c.c53b78",
        "name": "debug 18",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 820,
        "y": 340,
        "wires": []
    }
]